-- This script was generated by the ERD tool in pgAdmin 4.
-- Please log an issue at https://github.com/pgadmin-org/pgadmin4/issues/new/choose if you find any bugs, including reproduction steps.
BEGIN;


CREATE TABLE IF NOT EXISTS public.areas
(
    id_area integer NOT NULL GENERATED ALWAYS AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    nombre character varying(100) COLLATE pg_catalog."default" NOT NULL,
    id_departamento integer,
    CONSTRAINT areas_pkey PRIMARY KEY (id_area)
);

CREATE TABLE IF NOT EXISTS public.ast
(
    id_ast integer NOT NULL GENERATED ALWAYS AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    epp text COLLATE pg_catalog."default",
    maquinaria_equipo_herramientas text COLLATE pg_catalog."default",
    materiales_accesorios text COLLATE pg_catalog."default",
    CONSTRAINT ast_pkey PRIMARY KEY (id_ast)
);

CREATE TABLE IF NOT EXISTS public.ast_actividades
(
    id_ast_actividades integer NOT NULL GENERATED ALWAYS AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    id_ast integer NOT NULL,
    num_actividad character varying(200) COLLATE pg_catalog."default",
    secuencia_actividad character varying(300) COLLATE pg_catalog."default",
    personal_ejecutor character varying(150) COLLATE pg_catalog."default",
    peligros_potenciales character varying(350) COLLATE pg_catalog."default",
    acciones_preventivas character varying(350) COLLATE pg_catalog."default",
    responsable character varying(150) COLLATE pg_catalog."default",
    CONSTRAINT ast_actividades_pkey PRIMARY KEY (id_ast_actividades)
);

CREATE TABLE IF NOT EXISTS public.ast_participan
(
    id_ast_participan integer NOT NULL GENERATED ALWAYS AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    nombre character varying(250) COLLATE pg_catalog."default",
    credencial character varying(100) COLLATE pg_catalog."default",
    cargo character varying(100) COLLATE pg_catalog."default",
    funcion character varying(50) COLLATE pg_catalog."default",
    id_estatus integer NOT NULL,
    CONSTRAINT ast_participan_pkey PRIMARY KEY (id_ast_participan)
);

CREATE TABLE IF NOT EXISTS public.autorizaciones
(
    id_autorizacion integer NOT NULL GENERATED ALWAYS AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    id_permiso integer,
    id_supervisor integer,
    id_categoria integer,
    responsable_area character varying(100) COLLATE pg_catalog."default",
    operador_area character varying(150) COLLATE pg_catalog."default",
    CONSTRAINT autorizaciones_pkey PRIMARY KEY (id_autorizacion)
);

CREATE TABLE IF NOT EXISTS public.categorias_seguridad
(
    id_categoria integer NOT NULL GENERATED ALWAYS AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    nombre character varying(100) COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT categorias_seguridad_pkey PRIMARY KEY (id_categoria)
);

CREATE TABLE IF NOT EXISTS public.departamentos
(
    id_departamento integer NOT NULL GENERATED ALWAYS AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    nombre character varying(100) COLLATE pg_catalog."default" NOT NULL,
    correo character varying(100) COLLATE pg_catalog."default",
    extension character varying(20) COLLATE pg_catalog."default",
    "contraseña" character varying(255) COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT departamentos_pkey PRIMARY KEY (id_departamento)
);

CREATE TABLE IF NOT EXISTS public.estatus
(
    id_estatus integer NOT NULL GENERATED ALWAYS AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    estatus character varying(100) COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT estatus_pkey PRIMARY KEY (id_estatus)
);

CREATE TABLE IF NOT EXISTS public.jefe
(
    id_jefe serial NOT NULL,
    usuario character varying(50) COLLATE pg_catalog."default",
    "contraseña" character varying(100) COLLATE pg_catalog."default",
    CONSTRAINT jefe_pkey PRIMARY KEY (id_jefe)
);

CREATE TABLE IF NOT EXISTS public.permisos_trabajo
(
    id_permiso integer NOT NULL GENERATED ALWAYS AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    fecha_hora timestamp without time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
    id_area integer NOT NULL,
    id_departamento integer NOT NULL,
    id_sucursal integer NOT NULL,
    id_tipo_permiso integer NOT NULL,
    id_estatus integer NOT NULL,
    id_ast integer NOT NULL,
    prefijo character varying(50) COLLATE pg_catalog."default",
    CONSTRAINT permisos_trabajo_pkey PRIMARY KEY (id_permiso)
);

CREATE TABLE IF NOT EXISTS public.pt_no_peligroso
(
    id_ptnp integer NOT NULL GENERATED ALWAYS AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    id_permiso integer NOT NULL,
    nombre_solicitante character varying(100) COLLATE pg_catalog."default" NOT NULL,
    descripcion_trabajo character varying(350) COLLATE pg_catalog."default" NOT NULL,
    tipo_mantenimiento character varying(50) COLLATE pg_catalog."default" NOT NULL,
    ot_no character varying(50) COLLATE pg_catalog."default",
    equipo_intervencion character varying(100) COLLATE pg_catalog."default",
    hora_inicio timestamp without time zone NOT NULL,
    tag character varying(50) COLLATE pg_catalog."default",
    fluido character varying(50) COLLATE pg_catalog."default",
    presion character varying(20) COLLATE pg_catalog."default",
    temperatura character varying(20) COLLATE pg_catalog."default",
    empresa character varying(250) COLLATE pg_catalog."default",
    CONSTRAINT pt_no_peligroso_pkey PRIMARY KEY (id_ptnp)
);

CREATE TABLE IF NOT EXISTS public.sucursales
(
    id_sucursal integer NOT NULL GENERATED ALWAYS AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    nombre character varying(100) COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT sucursales_pkey PRIMARY KEY (id_sucursal)
);

CREATE TABLE IF NOT EXISTS public.supervisores
(
    id_supervisor integer NOT NULL GENERATED ALWAYS AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    nombre character varying(100) COLLATE pg_catalog."default" NOT NULL,
    correo character varying(100) COLLATE pg_catalog."default",
    extension character varying(20) COLLATE pg_catalog."default",
    "contraseña" character varying(255) COLLATE pg_catalog."default" NOT NULL,
    usuario character varying(150) COLLATE pg_catalog."default",
    CONSTRAINT supervisores_pkey PRIMARY KEY (id_supervisor)
);

CREATE TABLE IF NOT EXISTS public.tipos_permisos
(
    id_tipo_permiso integer NOT NULL GENERATED ALWAYS AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    nombre character varying(100) COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT tipos_permisos_pkey PRIMARY KEY (id_tipo_permiso)
);

ALTER TABLE IF EXISTS public.areas
    ADD CONSTRAINT fk_areas_departamentos FOREIGN KEY (id_departamento)
    REFERENCES public.departamentos (id_departamento) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.ast_actividades
    ADD CONSTRAINT ast_actividades_id_ast_fkey FOREIGN KEY (id_ast)
    REFERENCES public.ast (id_ast) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.ast_participan
    ADD CONSTRAINT ast_participan_id_estatus_fkey FOREIGN KEY (id_estatus)
    REFERENCES public.estatus (id_estatus) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.autorizaciones
    ADD CONSTRAINT autorizaciones_id_categoria_fkey FOREIGN KEY (id_categoria)
    REFERENCES public.categorias_seguridad (id_categoria) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.autorizaciones
    ADD CONSTRAINT autorizaciones_id_supervisor_fkey FOREIGN KEY (id_supervisor)
    REFERENCES public.supervisores (id_supervisor) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.permisos_trabajo
    ADD CONSTRAINT permisos_trabajo_id_area_fkey FOREIGN KEY (id_area)
    REFERENCES public.areas (id_area) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.permisos_trabajo
    ADD CONSTRAINT permisos_trabajo_id_ast_fkey FOREIGN KEY (id_ast)
    REFERENCES public.ast (id_ast) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.permisos_trabajo
    ADD CONSTRAINT permisos_trabajo_id_departamento_fkey FOREIGN KEY (id_departamento)
    REFERENCES public.departamentos (id_departamento) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.permisos_trabajo
    ADD CONSTRAINT permisos_trabajo_id_estatus_fkey FOREIGN KEY (id_estatus)
    REFERENCES public.estatus (id_estatus) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.permisos_trabajo
    ADD CONSTRAINT permisos_trabajo_id_sucursal_fkey FOREIGN KEY (id_sucursal)
    REFERENCES public.sucursales (id_sucursal) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.permisos_trabajo
    ADD CONSTRAINT permisos_trabajo_id_tipo_permiso_fkey FOREIGN KEY (id_tipo_permiso)
    REFERENCES public.tipos_permisos (id_tipo_permiso) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;


ALTER TABLE IF EXISTS public.pt_no_peligroso
    ADD CONSTRAINT pt_no_peligroso_id_permiso_fkey FOREIGN KEY (id_permiso)
    REFERENCES public.permisos_trabajo (id_permiso) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION;

END;





-- Tablas principales
SELECT * FROM areas;
SELECT * FROM departamentos;
SELECT * FROM sucursales;
SELECT * FROM supervisores;
SELECT * FROM estatus;
SELECT * FROM tipos_permisos;
SELECT * FROM categorias_seguridad;

-- Tablas de AST (Análisis de Seguridad en el Trabajo)
SELECT * FROM ast;
SELECT * FROM ast_actividades;
SELECT * FROM ast_participan;

-- Tablas de permisos
SELECT * FROM permisos_trabajo;
SELECT * FROM pt_no_peligroso;
SELECT * FROM autorizaciones;


INSERT INTO tipos_permisos ( nombre) VALUES
( 'PT No Peligroso'),
( 'PT para Apertura Equipo Línea'),
('PT de Entrada a Espacio Confinado'),
('PT en Altura'),
('PT de Fuego Abierto'),
('PT con Energía Eléctrica'),
('PT con Fuentes Radioactivas'),
('PT para Izaje con Hiab con Grúa');




