<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Syncro</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600&family=Orbitron:wght@500;700&family=Roboto:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="/CSS/EstiloGeneral.css" />
    <link rel="stylesheet" href="/CSS/EstiloCrearPermiso.css" />
    <link rel="stylesheet" href="/CSS/EstiloVer.css" />
  </head>
  <body>
    <div class="app-container">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="sidebar-header">
          <h2 class="logo-container">
            <i class="ri-refresh-line logo-icon"></i>
            <span class="logo-text">Syncro</span>
          </h2>
          <button class="collapse-btn">
            <i class="ri-menu-line menu-icon"></i>
            <i class="ri-arrow-right-s-line collapse-icon"></i>
          </button>
        </div>
        <nav class="sidebar-nav">
          <ul>
            <li>
              <a href="#"
                ><i class="ri-pie-chart-2-line"></i> <span>Dashboard</span></a
              >
            </li>
            <li>
              <a href="#"
                ><i class="ri-clipboard-line"></i>
                <span>Crear Permisos</span></a
              >
            </li>
            <li>
              <a href="#"
                ><i class="ri-shield-user-line"></i>
                <span>Autorizar Permisos</span></a
              >
            </li>
          </ul>
        </nav>
        <div class="sidebar-footer">
          <div class="user-profile">
            <div class="avatar">JP</div>
            <div class="user-info">
              <span class="name">Juan Pérez</span>
              <span class="role"></span>
            </div>
          </div>
          <button class="logout-btn">
            <i class="ri-logout-box-r-line"></i>
          </button>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <header class="main-header">
          <h1>
            <span style="font-size: 1.5rem">🧰</span> Creación de permisos
          </h1>
          <div class="header-actions">
            <div class="search-bar">
              <input type="text" placeholder="Buscar por permiso o contrato" />
              <i class="ri-search-line"></i>
            </div>
          </div>
        </header>

        <!-- Cards Section -->
        <section class="cards-section">
          <div class="card">
            <div class="card-icon" style="background-color: #eceff1">
              <i class="ri-file-list-2-line" style="color: #455a64"></i>
            </div>
            <div class="card-content">
              <h3>Total de Permisos</h3>
              <p class="count"></p>
            </div>
          </div>

          <div class="card">
            <div class="card-icon" style="background-color: #fff8e1">
              <i class="ri-alarm-warning-line" style="color: #ff8f00"></i>
            </div>
            <div class="card-content">
              <h3>Por Autorizar</h3>
              <p class="count"></p>
            </div>
          </div>

          <div class="card">
            <div class="card-icon" style="background-color: #e8f5e9">
              <i class="ri-check-line" style="color: #2e7d32"></i>
            </div>
            <div class="card-content">
              <h3>Activos</h3>
              <p class="count"></p>
            </div>
          </div>

          <div class="card">
            <div class="card-icon" style="background-color: #e3f2fd">
              <i class="ri-flag-line" style="color: #1565c0"></i>
            </div>
            <div class="card-content">
              <h3>Permisos Terminados</h3>
              <p class="count"></p>
            </div>
          </div>
          <div class="card">
            <div class="card-icon" style="background-color: #ffebee">
              <i class="ri-close-circle-line" style="color: #c62828"></i>
            </div>
            <div class="card-content">
              <h3>No Autorizados</h3>
              <p class="count"></p>
            </div>
          </div>
        </section>

        <!-- Actions Section -->
        <section class="actions-section">
          <button id="btnNuevoPermiso" class="btn primary">
            <i class="ri-add-line"></i> Generar Nuevo Permiso
          </button>

          <!-- Botón específico para exportar desde la vista Crear-PT -->
          <button
            id="export-excel-crear"
            class="btn secondary export-excel-crear"
          >
            <i class="ri-download-line"></i> Exportar a Excel
          </button>

          <div class="filter-dropdown">
            <select id="status-filter">
              <option value="all">Todos</option>
              <option value="Activo">Activo</option>
              <option value="Terminado">Terminado</option>
              <option value="Cancelado">Cancelado</option>
              <option value="En espera del área" selected>
                En espera del área
              </option>

              <option value="Espera seguridad">Espera seguridad</option>
              <option value="No autorizado">No autorizado</option>
            </select>
            <i class="ri-arrow-down-s-line"></i>
          </div>
        </section>

        <!-- Permits Table -->
        <section class="permits-table">
          <div class="table-header">
            <h3>Listado de Permisos</h3>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Permiso</th>
                  <th>Tipo de permiso</th>
                  <th>Tipo de actividad</th>
                  <th>Área</th>
                  <th>Solicitante</th>
                  <th>Fecha y hora</th>
                  <th>Estatus</th>
                  <th>Ver</th>
                </tr>
              </thead>
              <tbody id="table-body">
                <!-- Aquí se llenarán las filas dinámicamente -->
              </tbody>
            </table>
          </div>
          <div class="table-footer">
            <div class="pagination">
              <button class="pagination-btn">
                <i class="ri-arrow-left-s-line"></i>
              </button>
              <button class="pagination-btn active">1</button>
              <button class="pagination-btn">2</button>
              <button class="pagination-btn">3</button>
              <button class="pagination-btn">
                <i class="ri-arrow-right-s-line"></i>
              </button>
            </div>
            <div class="records-counter">
              <span id="records-count">0</span> registros
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- Modal de selección de permisos -->

    <div id="modalPermisos" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="titulo-permiso">Seleccionar Tipo de Permiso</h2>
          <span class="close-modal">&times;</span>
        </div>
        <div class="modal-body">
          <div class="permisos-grid">
            <div class="permiso-card" data-pt="pt1">
              <h3>No Peligrosos</h3>
              <p>
                Permiso para trabajos de bajo riesgo que no involucran peligros
                específicos como altura, espacios confinados, electricidad,
                fuego, radiación u otros riesgos significativos para la
                seguridad.
              </p>
              <button class="btn primary seleccionar-permiso">
                Seleccionar
              </button>
            </div>
            <div class="permiso-card" data-pt="pt2">
              <h3>Apertura de Equipo en Línea</h3>
              <p>
                Autorización para abrir equipos que están en operación o
                conectados a sistemas en funcionamiento, requiriendo
                procedimientos específicos de seguridad para evitar riesgos.
              </p>
              <button class="btn primary seleccionar-permiso">
                Seleccionar
              </button>
            </div>
            <div class="permiso-card" data-pt="pt3">
              <h3>Espacios Confinados</h3>
              <p>
                Para trabajos en áreas con acceso limitado, ventilación
                restringida y no diseñadas para ocupación continua, que pueden
                contener atmósferas peligrosas.
              </p>
              <button class="btn primary seleccionar-permiso">
                Seleccionar
              </button>
            </div>
            <div class="permiso-card" data-pt="pt4">
              <h3>Trabajo en Altura</h3>
              <p>
                Autorización para realizar labores a más de 1.8 metros de
                altura, requiriendo equipo de protección contra caídas y
                supervisión adecuada.
              </p>
              <button class="btn primary seleccionar-permiso">
                Seleccionar
              </button>
            </div>
            <div class="permiso-card" data-pt="pt5">
              <h3>Trabajo con Fuego Abierto</h3>
              <p>
                Para actividades que generan chispas, llamas o calor intenso,
                requiriendo medidas especiales de prevención de incendios.
              </p>
              <button class="btn primary seleccionar-permiso">
                Seleccionar
              </button>
            </div>
            <div class="permiso-card" data-pt="pt6">
              <h3>Energía Eléctrica</h3>
              <p>
                Permiso para trabajos en o cerca de circuitos energizados,
                incluyendo mantenimiento eléctrico, instalaciones o reparaciones
                en sistemas eléctricos.
              </p>
              <button class="btn primary seleccionar-permiso">
                Seleccionar
              </button>
            </div>
            <div class="permiso-card" data-pt="pt7">
              <h3>Fuentes Radioactivas</h3>
              <p>
                Para manipulación o trabajo cerca de materiales radiactivos,
                requiriendo monitoreo de radiación y equipo de protección
                especializado.
              </p>
              <button class="btn primary seleccionar-permiso">
                Seleccionar
              </button>
            </div>
            <div class="permiso-card" data-pt="pt8">
              <h3>Apertura de Equipo</h3>
              <p>
                Autorización para abrir equipos que podrían contener energía
                residual, sustancias peligrosas o partes móviles.
              </p>
              <button class="btn primary seleccionar-permiso">
                Seleccionar
              </button>
            </div>
            <div class="permiso-card" data-pt="pt9">
              <h3>Cesta Suspendida con Grúa</h3>
              <p>
                Para trabajos realizados desde plataformas elevadoras móviles de
                personal (PEMP) o canastillas suspendidas por grúas, requiriendo
                inspección previa del equipo.
              </p>
              <button class="btn primary seleccionar-permiso">
                Seleccionar
              </button>
            </div>
            <div class="permiso-card" data-pt="pt10">
              <h3>Permiso de Excavación/Perforación</h3>
              <p>
                Permiso para realizar excavaciones o perforaciones en el suelo,
                requiriendo precauciones específicas para evitar daños a
                infraestructuras y seguridad.
              </p>
              <button class="btn primary seleccionar-permiso">
                Seleccionar
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal de ver -->
    <div id="modalVer" class="modal">
      <div class="modal-content executive-view">
        <!-- Header del Modal -->
        <div class="modal-header">
          <div class="permit-title">
            <h2 id="modal-tipo-permiso">PERMISO DE TRABAJO NO PELIGROSO</h2>
            <div class="permit-number" id="modal-prefijo">
              No. GSI-SI-FO-002 PERMISO DE TRABAJO NO PELIGROSO
            </div>
          </div>
          <span class="close-modal">&times;</span>
        </div>

        <!-- Cuerpo del Modal -->
        <div class="modal-body">
          <!-- Sección 1: Información General -->
          <div class="executive-section">
            <div class="section-header">
              <i class="ri-information-line"></i>
              <h3>Información General</h3>
            </div>
            <div class="executive-grid">
              <div class="executive-item">
                <label>Fecha:</label>
                <p class="highlight" id="info-fecha"></p>
              </div>
              <div class="executive-item">
                <label>Empresa:</label>
                <p id="info-empresa"></p>
              </div>
              <div class="executive-item">
                <label>Sucursal:</label>
                <p id="info-sucursal"></p>
              </div>
              <div class="executive-item">
                <label>Departamento que creo el PT:</label>
                <p class="highlight" id="ver-departamento"></p>
              </div>
              <div class="executive-item">
                <label>Solicitante:</label>
                <p id="info-solicitante"></p>
              </div>

              <div>
                <label>Número de contrato:</label>
                <span id="info-contrato"></span>
              </div>
              <div class="executive-item full-width">
                <label>Descripción del trabajo:</label>
                <p class="description-box" id="info-descripcion"></p>
              </div>
            </div>
          </div>

          <!-- Sección 2: Detalles Técnicos -->
          <div class="executive-section">
            <div class="section-header">
              <i class="ri-tools-line"></i>
              <h3>Permiso de Trabajo</h3>
              <span
                id="modal-tipo-especifico"
                class="tipo-especifico-label"
              ></span>
            </div>
            <div
              id="modal-no-peligroso"
              class="executive-grid"
              style="display: none"
            >
              <div class="executive-item">
                <label>Planta:</label>
                <p id="modal-planta"></p>
              </div>
              <div class="executive-item">
                <label>Tipo de actividad:</label>
                <p id="modal-tipo-actividad"></p>
              </div>
              <div class="executive-item">
                <label>OT:</label>
                <p id="modal-ot"></p>
              </div>
              <div class="executive-item">
                <label>Equipo:</label>
                <p id="modal-equipo"></p>
              </div>
              <div class="executive-item">
                <label>Tag:</label>
                <p id="modal-tag"></p>
              </div>
              <div class="executive-item">
                <label>Horario:</label>
                <p id="modal-horario"></p>
              </div>

              <div class="executive-item">
                <label>Trabajo área riesgo controlado:</label>
                <p id="modal-trabajo-area-riesgo-controlado"></p>
              </div>
              <div class="executive-item">
                <label>¿Necesita entrega física?:</label>
                <p id="modal-necesita-entrega-fisica"></p>
              </div>
              <div class="executive-item">
                <label>¿Necesita PPE adicional?:</label>
                <p id="modal-necesita-ppe-adicional"></p>
              </div>
              <div class="executive-item">
                <label>Área circundante riesgo:</label>
                <p id="modal-area-circundante-riesgo"></p>
              </div>
              <div class="executive-item">
                <label>¿Necesita supervisión?:</label>
                <p id="modal-necesita-supervision"></p>
              </div>
              <div class="executive-item">
                <label>Observaciones análisis previo:</label>
                <p id="modal-observaciones-analisis-previo"></p>
              </div>
            </div>
            <!-- Aquí el JS inyecta los campos de apertura -->
            <div id="modal-especifica"></div>

            <div id="modal-especifica"></div>
            <div id="modal-apertura-area-visual"></div>
            <div id="contenedor-apertura-supervisor"></div>
          </div>

          <div class="executive-section">
            <div class="section-header">
              <i class="ri-shield-check-line"></i>
              <h3>AST - Análisis de Seguridad en el Trabajo</h3>
            </div>
            <div class="ast-summary">
              <table class="ast-table">
                <thead>
                  <tr>
                    <th>No.</th>
                    <th>Secuencia de la Actividad</th>
                    <th>Personal Ejecutor</th>
                    <th>Peligros Potenciales</th>
                    <th>Acciones Preventivas</th>
                    <th>Responsable</th>
                  </tr>
                </thead>
                <tbody id="modal-ast-actividades-body">
                  <!-- Actividades AST dinámicas -->
                </tbody>
              </table>
            </div>
            <div class="safety-grid">
              <div class="safety-item">
                <h4><i class="ri-shield-user-line"></i> EPP Requerido</h4>
                <ul class="safety-list" id="modal-epp-list">
                  <li>Casco de seguridad</li>
                </ul>
              </div>
              <div class="safety-item">
                <h4><i class="ri-tools-line"></i> Maquinaria y Herramientas</h4>
                <ul class="safety-list" id="modal-maquinaria-list">
                  <li>Llave Stillson</li>
                </ul>
              </div>
              <div class="safety-item">
                <h4><i class="ri-box-line"></i> Materiales y Accesorios</h4>
                <ul class="safety-list" id="modal-materiales-list">
                  <li>Empaques</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Sección 4: Participantes -->
          <div class="executive-section">
            <div class="section-header">
              <i class="ri-team-line"></i>
              <h3>Personal Involucrado</h3>
            </div>
            <div class="ast-summary">
              <table class="ast-table">
                <thead>
                  <tr>
                    <th>Nombre</th>
                    <th>Función</th>
                    <th>Credencial</th>
                    <th>Cargo</th>
                  </tr>
                </thead>
                <tbody id="modal-ast-participantes-body">
                  <!-- Participantes AST dinámicos -->
                </tbody>
              </table>
            </div>

            <!-- Aca pongo mi comentario por el modal -->
            <div id="contenedor-comentario"></div>
          </div>

          <!-- Footer del Modal -->

          <div class="botones-footer">
            <button id="btn-cancelar-especial" class="btn cancel-special-btn">
              <i class="ri-close-line"></i> Cancelar Permiso
            </button>
            <button id="btn-terminar-especial" class="btn finish-special-btn">
              <i class="ri-check-line"></i> Permiso Terminado
            </button>
          </div>
        </div>
      </div>
    </div>

    <div id="modalComentario" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Agregar comentario</h2>
        </div>
        <div class="modal-body">
          <textarea
            id="comentario"
            rows="4"
            style="width: 100%"
            placeholder="Escribe tu comentario aquí..."
          ></textarea>
        </div>
        <div class="modal-footer">
          <button class="btn enviar-btn">
            <i class="ri-send-plane-line"></i> Enviar
          </button>
          <button class="btn cancelar-btn">
            <i class="ri-arrow-go-back-line"></i> Cancelar
          </button>
        </div>
      </div>
    </div>

    <!-- Modal de comentario para Cancelar Especial -->
    <div id="modalComentarioCancelarEspecial" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Agregar comentario</h2>
        </div>
        <div class="modal-body">
          <textarea
            id="comentario-cancelar-especial"
            rows="4"
            style="width: 100%"
            placeholder="Escribe tu comentario aquí..."
          ></textarea>
        </div>
        <div class="modal-footer">
          <button id="cancelarEspecial-cancelar-btn" class="btn cancelar-btn">
            Cancelar
          </button>
          <button
            id="cancelarEspecial-enviar-btn"
            class="btn cancelar_enviar_especial-btn"
          >
            Enviar Cancelación
          </button>
        </div>
      </div>
    </div>

    <!-- Modal de comentario para Terminar Especial -->
    <div id="modalComentarioTerminarEspecial" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Agregar comentario</h2>
        </div>
        <div class="modal-body">
          <textarea
            id="comentario-terminar-especial"
            rows="4"
            style="width: 100%"
            placeholder="Escribe tu comentario aquí..."
          ></textarea>
        </div>
        <div class="modal-footer">
          <button class="btn cancelar-btn">
            <i class="ri-arrow-go-back-line"></i> Cancelar
          </button>
          <button class="btn terminar_enviar_especial-btn">
            <i class="ri-send-plane-line"></i> Permiso Terminado
          </button>
        </div>
      </div>
    </div>

    <div id="modal-no-peligroso" style="display: none">
      <div class="executive-item">
        <label>Planta:</label>
        <p id="modal-planta"></p>
      </div>
      <div class="executive-item">
        <label>Tipo de actividad:</label>
        <p id="modal-tipo-actividad"></p>
      </div>
      <!-- ...resto de campos... -->
    </div>

    <script src="/JS/usuario/MenuUsuario.js"></script>
    <script src="/JS/usuario/LogicaCrearPermiso.js"></script>
    <script src="/JS/generales/LogicaVer.js"></script>
    <script type="module" src="/JS/usuario/tabla-crearpt.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="/JS/usuario/crear_exportar.js"></script>
  </body>
</html>
