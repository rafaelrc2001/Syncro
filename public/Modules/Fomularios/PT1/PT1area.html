<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Permiso No Peligroso</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" rel="stylesheet">
        <link rel="stylesheet" href="/CSS/EstiloGeneral.css" />
 <!--  <link rel="stylesheet" href="/CSS/EstiloVer.css"> -->
   <link rel="stylesheet" href="/CSS/EstiloImprimir.css">
   <link rel="stylesheet" href="/CSS/imprimir/EstiloImprimir-Base.css">
</head>
<body style="background: #f4f6fb; min-height: 100vh; margin: 0; font-family: 'Roboto', Arial, sans-serif;">
        <div style="display: flex; justify-content: center; align-items: flex-start; min-height: 100vh;">
            <section class="form-section" data-section="2" style="max-width: 900px; width: 100%; margin: 40px 0; background: #fff; border-radius: 18px; box-shadow: 0 4px 24px rgba(44,62,80,0.10); padding: 2.5rem 2rem;">
                <div class="company-header">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <img src="/img/proagro.png" alt="Logo ProAgro" style="height: 60px; width: auto;">
                </div>
                <div style="text-align: center; flex-grow: 1;">
                    <h1 style="margin: 0; color: #2c3e50; font-size: 1.5rem; font-weight: 600;">SISTEMA DE PERMISOS DE TRABAJO</h1>
                    <p style="margin: 0.5rem 0 0 0; color: #7f8c8d; font-size: 0.9rem;">Gestión Integral de Seguridad Laboral</p>
                </div>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                    <img src="/img/pemex.png" alt="Logo PEMEX" style="height: 60px; width: auto;">
                </div>
         
            </div>
                <div class="section-header header-centered">
    <i class="ri-checkbox-circle-line"></i>
    <h2>Permiso de Trabajo</h2>
    <h3>NP-XXXXXX</h3>
            </div>
                               
                                    <div class="general-box-header">
                                        <span>Información General</span>
                                    </div>

                                <div  id="hora-creacion-header" style="text-align: center;">
                                    <i class="ri-time-line"></i>
                                    <h3>Hora de creación</h3>
                                </div>


                  <div class="executive-section " style="margin-bottom: 0; box-shadow: none; background: transparent; border: none;">
                      
                        
                      <div class="executive-grid">
                          <div class="executive-item">
                              <label>Hora de inicio</label>
                              <p id="start-time-label">-</p>
                          </div>
                          <div class="executive-item">
                              <label>Fecha</label>
                              <p id="fecha-label">-</p>
                          </div>
                          <div class="executive-item">
                              <label>Tipo de actividad</label>
                              <p id="activity-type-label">-</p>
                          </div>
                          <div class="executive-item">
                              <label>Planta o lugar de trabajo</label>
                              <p id="plant-label">-</p>
                          </div>
                          <div class="executive-item">
                              <label>Descripción del trabajo</label>
                              <p id="descripcion-trabajo-label">-</p>
                          </div>
                          <div class="executive-item">
                              <label>Empresa</label>
                              <p id="empresa-label">-</p>
                          </div>
                          <div class="executive-item">
                              <label>Nombre de quien solicita</label>
                              <p id="nombre-solicitante-label">-</p>
                          </div>
                          <div class="executive-item">
                              <label>Sucursal</label>
                              <p id="sucursal-label">-</p>
                          </div>
                          <div class="executive-item">
                              <label>Contrato</label>
                              <p id="contrato-label">-</p>
                          </div>
                          <div class="executive-item">
                              <label>O.T. No.</label>
                              <p id="work-order-label">-</p>
                          </div>
                      </div>
                  </div>
                
                <div class="executive-section ">
                    <div class="section-header">
                        <i class="ri-tools-line"></i>
                        <h3>Equipo</h3>
                    </div>
                    <div class="executive-grid">
                        <div class="executive-item">
                            <label>¿Tiene Equipo a Intervenir?</label>
                            <p id="equipment-intervene-label">-</p>
                        </div>
                        <div class="executive-item">
                            <label>Equipo a Intervenir</label>
                            <p id="equipment-label">-</p>
                        </div>
                        <div class="executive-item">
                            <label>TAG</label>
                            <p id="tag-label">-</p>
                        </div>
                    </div>
                </div>




        

                          
                                    <div class="area-box-header">
                                         <span>Formulario Responsable Área</span>
                                     </div>
              
                <div class="executive-section ">
                    <div class="section-header ">
                        <i class="ri-flask-line"></i>
                        <h3>Condiciones del Proceso</h3>
                    </div>
                    <div class="executive-grid">
                        <div class="executive-item">
                            <label for="fluid">Fluido</label>
                            <input type="text" id="fluid" name="fluid" class="compact" value="" style="width:100%; background:#fff; border:1px solid #d0d7de; border-radius:6px; padding:6px 10px;">
                        </div>
                        <div class="executive-item">
                            <label for="pressure">Presión</label>
                            <input type="text" id="pressure" name="pressure" class="compact" value="" style="width:100%; background:#fff; border:1px solid #d0d7de; border-radius:6px; padding:6px 10px;">
                        </div>
                        <div class="executive-item">
                            <label for="temperature">Temperatura</label>
                            <input type="text" id="temperature" name="temperature" class="compact" value="" style="width:100%; background:#fff; border:1px solid #d0d7de; border-radius:6px; padding:6px 10px;">
                        </div>
                    </div>
                </div>


                <div class="executive-section ">
                    <div class="section-header section-header-cielo">
                        <i class="ri-checkbox-multiple-line"></i>
                        <h3>Análisis Previo al Trabajo</h3>
                    </div>
                    <form id="form-no-peligroso-analisis">
                        <table class="styled-table" style="width:100%; background:#fff; border-radius:8px; overflow:hidden;">
                            <thead class="thead-nopeligroso">
                                <tr>
                                    <th>Pregunta</th>
                                    <th class="centered">SI</th>
                                    <th class="centered">NO</th>
                                    <th class="centered">N/A</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>¿El trabajo se realizará en un área de riesgo controlado?</td>
                                    <td class="centered"><input type="radio" name="risk-area" value="si"></td>
                                    <td class="centered"><input type="radio" name="risk-area" value="no"></td>
                                    <td class="centered"><input type="radio" name="risk-area" value="na"></td>
                                </tr>
                                <tr>
                                    <td>¿Se necesita entrega física, para efectuar el trabajo por parte del personal de la planta o departamento?</td>
                                    <td class="centered"><input type="radio" name="physical-delivery" value="si"></td>
                                    <td class="centered"><input type="radio" name="physical-delivery" value="no"></td>
                                    <td class="centered"><input type="radio" name="physical-delivery" value="na"></td>
                                </tr>
                                <tr>
                                    <td>¿El personal que va a ejecutar el trabajo, necesita equipo de protección personal adicional al estándar del área donde se desarrollará el trabajo?</td>
                                    <td class="centered"><input type="radio" name="additional-ppe" value="si"></td>
                                    <td class="centered"><input type="radio" name="additional-ppe" value="no"></td>
                                    <td class="centered"><input type="radio" name="additional-ppe" value="na"></td>
                                </tr>
                                <tr>
                                    <td>¿En el área circundante se efectuarán trabajos con riesgo?</td>
                                    <td class="centered"><input type="radio" name="surrounding-risk" value="si"></td>
                                    <td class="centered"><input type="radio" name="surrounding-risk" value="no"></td>
                                    <td class="centered"><input type="radio" name="surrounding-risk" value="na"></td>
                                </tr>
                                <tr>
                                    <td>¿Necesita supervisión el personal?</td>
                                    <td class="centered"><input type="radio" name="supervision-needed" value="si"></td>
                                    <td class="centered"><input type="radio" name="supervision-needed" value="no"></td>
                                    <td class="centered"><input type="radio" name="supervision-needed" value="na"></td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="executive-item" style="margin-top:1em;">
                            <label for="pre-work-observations">Observaciones adicionales:</label>
                            <textarea id="pre-work-observations" name="pre-work-observations" rows="2" style="width:100%; background:#fff; border:1px solid #d0d7de; border-radius:6px; padding:6px 10px;" placeholder="Ingrese observaciones adicionales..."></textarea>
                        </div>
                
                </div>




                        <!-- Sección AST y Participantes -->
            
                        
           
                        <div class="executive-section ">
            
                            <div class="section-header">
                        <i class="ri-shield-check-line"></i>
                        <h3>AST - Análisis de Seguridad en el Trabajo</h3>
                    </div>
                    <div class="ast-summary">
                        <table class="ast-table">
                            <thead>
                                <tr>
                                    <th>No.</th>
                                    <th>Secuencia de la Actividad</th>
                                    <th>Personal Ejecutor</th>
                                    <th>Peligros Potenciales</th>
                                    <th>Acciones Preventivas</th>
                                    <th>Responsable</th>
                                </tr>
                            </thead>
                            <tbody id="modal-ast-actividades-body">
                                <!-- Actividades AST dinámicas -->
                            </tbody>
                        </table>
                    </div>
                    <div class="safety-grid">
                        <div class="safety-item">
                            <h4><i class="ri-shield-user-line"></i> EPP Requerido</h4>
                            <ul class="safety-list" id="modal-epp-list">
                                <li></li>
                            </ul>
                        </div>
                        <div class="safety-item">
                            <h4><i class="ri-tools-line"></i> Maquinaria y Herramientas</h4>
                            <ul class="safety-list" id="modal-maquinaria-list">
                                <li></li>
                            </ul>
                        </div>
                        <div class="safety-item">
                            <h4><i class="ri-box-line"></i> Materiales y Accesorios</h4>
                            <ul class="safety-list" id="modal-materiales-list">
                                <li></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <!-- Sección 4: Participantes -->
                <div class="executive-section ">
                    <div class="section-header">
                        <i class="ri-team-line"></i>
                        <h3>Personal Involucrado</h3>
                    </div>
                    <div class="ast-summary">
                        <table class="ast-table">
                            <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>Función</th>
                                    <th>Credencial</th>
                                    <th>Cargo</th>
                                </tr>
                            </thead>
                            <tbody id="modal-ast-participantes-body">
                                <!-- Participantes AST dinámicos -->
                            </tbody>
                        </table>
                    </div>
                </div>


 


                <div class="executive-section" style="display: flex; gap: 24px; align-items: flex-end">
                    <div style="flex: 1">
                        <label for="responsable-aprobador" style="font-weight: 600; display: block; margin-bottom: 8px">
                            Agregar nombre del responsable del área:
                        </label>
                        <input type="text" id="responsable-aprobador" placeholder="Nombre del responsable del área" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ccc;" />
                    </div>
                    <div style="flex: 1">
                        <label for="responsable-aprobador2" style="font-weight: 600; display: block; margin-bottom: 8px">
                            Agregar nombre del operador del área:
                        </label>
                        <input type="text" id="responsable-aprobador2" placeholder="Nombre del operador del área" style="width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ccc;" />
                    </div>
                </div>

          


                          <div class="button-group" style="display: flex; justify-content: space-between; margin-top: 48px; gap: 16px;">
                            <button id="btn-salir-nuevo" class="btn btn-pt1 btn-salir-gris" type="button">
                                <i class="ri-logout-box-r-line" style="margin-right: 8px;"></i>Salir
                            </button>
                            <div style="display: flex; gap: 16px;">
                                

                                <button id="btn-pregunta-autorizar" class="btn btn-pt1 btn-guardar-azulpetroleo" type="button">
                                    <i class="ri-save-3-line" style="margin-right: 8px;"></i>Autorizar
                                </button>
                                <button id="btn-no-autorizar" class="btn btn-pt1 btn-noautorizar-rojo" type="button">
                                    <i class="ri-close-circle-line" style="margin-right: 8px;"></i>No Autorizar
                                </button>
                                                                <button id="btn-cierre-permiso" class="btn btn-pt1 btn-guardar-azulpetroleo" type="button">
                                                                        <i class="ri-close-circle-line" style="margin-right: 8px;"></i>Cierre del Permiso
                                                                </button>

<!-- Modal de confirmación de cierre de permiso -->
<div id="modalConfirmarCierre" class="modal-confirmar" style="display:none;">
    <div class="modal-confirmar-content">
        <div class="modal-confirmar-icon modal-cierre-icon">
            <i class="ri-close-circle-line" style="color:#2c3e50; font-size:2em;"></i>
        </div>
        <h3>¿Seguro que deseas cerrar el permiso?</h3>
        <p class="modal-confirmar-warning">
            <i class="ri-alert-line" style="color:#e53935; font-size:1.3em; vertical-align:middle; margin-right:6px;"></i>
            Esta acción no se podrá deshacer y el permiso será marcado como cerrado.
        </p>
        <div class="modal-confirmar-actions">
            <button id="btnCancelarCierre" type="button" class="btn-cancel">Cancelar</button>
            <button id="btnConfirmarCierre" type="button" class="btn-confirm">Cerrar Permiso</button>
        </div>
    </div>
</div>





                            <!--  <button id="btn-guardar-campos" class="btn btn-pt1 btn-guardar-azulpetroleo" type="button">
                                    <i class="ri-save-3-line" style="margin-right: 8px;"></i>Autorizar
                                </button>-->
                              
                            </div>
                    </div>
                                        </form>
                                        <!-- Modal para motivo de no autorización -->
                                        <div id="modalComentario" class="modal-comentario" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(44,62,80,0.25); z-index:1000; justify-content:center; align-items:center;">
                                            <div style="background:#fff; border-radius:12px; max-width:400px; width:90vw; padding:2em 1.5em; box-shadow:0 4px 24px rgba(44,62,80,0.18); display:flex; flex-direction:column; gap:1em;">
                                                <h3 style="margin:0 0 0.5em 0; font-size:1.2em; color:#c0392b;"><i class="ri-close-circle-line" style="margin-right:8px;"></i>Motivo de No Autorización</h3>
                                                <textarea id="comentarioNoAutorizar" rows="4" style="width:100%; border:1px solid #d0d7de; border-radius:6px; padding:8px; resize:vertical;" placeholder="Escribe el motivo del rechazo..."></textarea>
                                                <div style="display:flex; justify-content:flex-end; gap:10px;">
                                                    <button id="btnCancelarComentario" type="button" style="background:#eee; color:#333; border:none; border-radius:4px; padding:6px 16px; cursor:pointer;">Cancelar</button>
                                                    <button id="btnGuardarComentario" type="button" style="background:#c0392b; color:#fff; border:none; border-radius:4px; padding:6px 16px; cursor:pointer;">Guardar</button>
                                                </div>
                                            </div>
                                        </div>



                                          <!-- Modal de confirmación -->
                        <div class="modal" id="confirmation-modal" style="display:none;">
                            <div class="modal-content">
                                <div class="modal-icon success">
                                    <i class="ri-checkbox-circle-line"></i>
                                </div>
                                <h3>Permiso autorizado correctamente</h3>
                                <p>El permiso de trabajo el número: <strong id="generated-permit">-</strong></p>
                                <div class="modal-actions">
                                    <button class="btn secondary" id="modal-close-btn">Cerrar</button>
                                    
                                </div>
                            </div>
                        </div>


                        <!-- Modal de confirmación de autorización -->
                        <div id="modalConfirmarAutorizar" class="modal-confirmar" style="display:none;">
                        <div class="modal-confirmar-content">
                            <div class="modal-confirmar-icon">
                            <i class="ri-check-double-line"></i>
                            </div>
                            <h3>Confirmar Autorización</h3>
                           <p class="modal-confirmar-warning">
                            <i class="ri-alert-line" style="color:#e53935; font-size:1.3em; vertical-align:middle; margin-right:6px;"></i>
                            ¿Estás seguro que deseas autorizar este permiso?
                            </p>
                              <p class="modal-confirmar-note">Esta acción no se podrá deshacer.</p>
                          
                            <div class="modal-confirmar-details">
                            <div><span>ID del Permiso:</span> <strong id="modal-permit-id">-</strong></div>
                            <div><span>Tipo de Permiso:</span> <strong id="modal-permit-type">-</strong></div>
                            <div><span>Solicitante:</span> <strong id="modal-solicitante">-</strong></div>
                            <div><span>Departamento:</span> <strong id="modal-departamento">-</strong></div>
                            </div>
                            <div class="modal-confirmar-actions">
                            <button id="btnCancelarConfirmar" type="button" class="btn-cancel">Cancelar</button>
                            <button id="btnConfirmarAutorizar" type="button" class="btn-confirm">Autorizar</button>
                            </div>
                        </div>
                        </div>

                         <div id="modalConfirmarNoAutorizar" class="modal-confirmar" style="display:none;">
                            <div class="modal-confirmar-content">
                                <div class="modal-confirmar-icon modal-noautorizar-icon">
                                <i class="ri-close-circle-line"></i>
                                </div>
                                <h3>Confirmar No Autorización</h3>
                               <p class="modal-confirmar-warning">
                                <i class="ri-alert-line" style="color:#e53935; font-size:1.3em; vertical-align:middle; margin-right:6px;"></i>
                                ¿Estás seguro que deseas <b>NO autorizar</b> este permiso?
                                </p>
                                <p class="modal-confirmar-note">Una vez autorizado, esta acción no se podrá deshacer. Luego deberás ingresar el motivo del rechazo.</p>
                                <div class="modal-confirmar-details">
                                <div><span>ID del Permiso:</span> <strong id="modal-permit-id-no">-</strong></div>
                                <div><span>Tipo de Permiso:</span> <strong id="modal-permit-type-no">-</strong></div>
                                <div><span>Solicitante:</span> <strong id="modal-solicitante-no">-</strong></div>
                                <div><span>Departamento:</span> <strong id="modal-departamento-no">-</strong></div>
                                </div>
                                <div class="modal-confirmar-actions">
                                <button id="btnCancelarConfirmarNo" type="button" class="btn-cancel">Cancelar</button>
                                <button id="btnConfirmarNoAutorizar" type="button" class="btn-noautorizar">No Autorizar</button>
                                </div>
                            </div>
                            </div>





                </div>
            </div>
        
        </div>



<div id="loader-ubicacion" style="
  display:none;
  position:fixed;
  top:0; left:0;
  width:100vw; height:100vh;
  background:rgba(44,62,80,0.18);
  z-index:99999;
  justify-content:center; align-items:center;
  backdrop-filter: blur(2px);
">
  <div style="
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:18px;
    background:rgba(255,255,255,0.85);
    border-radius:18px;
    box-shadow:0 8px 32px rgba(44,62,80,0.18);
    padding:32px 48px;
  ">
    <img src="/img/loader.gif" alt="Cargando..." style="width:80px; height:80px; margin-bottom:8px;">
    <p style="
      color:#2c3e50;
      font-size:2.2em;
      font-weight:700;
      margin:0;
      letter-spacing:1px;
      text-shadow:0 2px 8px rgba(44,62,80,0.10);
    ">Cargando...</p>
  </div>
</div>


        
</body>
    
</html>


   <!-- Script de verificación de autenticación -->
    <script src="/JS/generales/auth-check.js"></script>
    <script>
      // Verificar autenticación antes de cargar contenido
      (async function () {
        const usuario = await verificarRol(["departamentos"]);
        if (!usuario) return; // auth-check.js ya redirigió
        // El contenido se carga normalmente si está autenticado
      })();
    </script>

     <!-- <script src="/Modules/Fomularios/PT1/PT1.js"></script>-->

       <script src="/Modules/Fomularios/Generales/fecha_hora.js"></script>
       <script src="/Modules/Fomularios/Generales/obtenerUbicacionYIP.js"></script>
     <script src="/Modules/Fomularios/PT1/PT1seccionarea.js"></script>
</body>
</html>