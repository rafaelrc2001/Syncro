<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Syncro - Nuevo Permiso Completo</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" rel="stylesheet">
    <!-- <link rel="stylesheet" href="/Modules/Fomularios/Generales/seccion2.css">-->
      <!-- <link rel="stylesheet" href="P-NPCSS.css">-->

          <link rel="stylesheet" href="/CSS/EstiloFormularios.css">
          <link rel="stylesheet" href="/CSS/prueba.css">
          <!-- Estilos para funcionalidad Drag & Drop del Constructor de Formato -->
          <link rel="stylesheet" href="/CSS/EstiloDragDrop.css">
          <link rel="stylesheet" href="/CSS/EstiloPermisosDrag.css">

        <!-- Estilos responsivos para celular vertical y horizontal -->
        <link rel="stylesheet" href="/CSS/estilopruebascelular.css">
        
</head>
<body>
    <div class="app-container">
        <!-- Sidebar (igual al existente) -->
        <aside class="sidebar">
            <!-- Contenido del sidebar igual al original -->
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="main-header">
                <h1><span style="font-size: 1.2rem;">üß∞</span> Permiso de Trabajo  </h1>
                <div class="header-actions">
                    <button class="btn secondary" id="back-btn">
                        <i class="ri-arrow-left-line"></i> Volver
                    </button>
                </div>
            </header>

            <!-- Progress Steps -->
            <div class="progress-container">
                <div class="progress-steps">
                    <div class="step active" data-step="1">
                        <div class="step-number">1</div>
                        <div class="step-title">Encabezado</div>
                    </div>
                    <div class="step" data-step="2">
                        <div class="step-number">2</div>
                        <div id="PermisoNP"class="step-title">Permiso </div>
                    </div>
                    <div class="step" data-step="3">
                        <div class="step-number">3</div>
                        <div class="step-title">Participantes</div>
                    </div>
                    <div class="step" data-step="4">
                        <div class="step-number">4</div>
                        <div class="step-title">AST</div>
                    </div>
                </div>
            </div>

            <!-- Form Sections -->
            <form id="complete-permit-form">
                <!-- Secci√≥n 1: Encabezado -->
                <section class="form-section active" data-section="1">
                    <div class="form-container">
                        <div class="form-header">
                            <div class="form-icon">
                                <i class="ri-file-text-line"></i>
                            </div>
                            <div>
                                <h2>Informaci√≥n General del Permiso</h2>
                                <p>Complete los datos b√°sicos del permiso</p>
                            </div>
                        </div>



                        <div class="form-grid">
                        <!--    <div class="form-group">
                                <label for="permit-number">N√∫mero de Permiso</label>
                                <input type="text" id="permit-number" name="permit-number" readonly value="GSI-SI-FO-002-XXXX">
                            </div>
                        -->
                            <div class="form-group">
                                <label for="permit-date">Fecha</label>
                                <input type="date" id="permit-date" name="permit-date" required>
                            </div>
                            <div class="form-group">
                                <label for="start-time">Hora de inicio</label>
                                <input type="time" id="start-time" name="start-time" required class="compact">
                            </div>

                            <div class="form-group">
                                <label for="company">Empresa</label>
                                <input type="text" id="company" name="company" value="PRO-AGROINDUSTRIA" readonly>
                            </div>


                              <div class="form-group">
                                <label for="area">Sucursal</label>
                                <div class="select-wrapper">
                                    <select id="sucursal" name="sucursal" required>
                                        <option value="" disabled selected>Seleccione una sucursal</option>
                                    </select>
                                    <i class="ri-arrow-down-s-line select-arrow"></i>
                                </div>
                            </div>


                            <div class="form-group">
                                <label for="subcontract">Departamento o contratista</label>
                                <input type="text" id="subcontract" name="subcontract" >
                            </div>

                          
                            
                            


                        <div class="form-group">
                            <label for="departamento">Area de trabajo</label>
                            <div class="autocomplete-container">
                                <input type="text" id="departamento" name="departamento" required 
                                       placeholder="Escriba para buscar..." 
                                       class="autocomplete-input"
                                       autocomplete="off">
                                <div id="departamento-suggestions" class="autocomplete-suggestions"></div>
                                <input type="hidden" id="departamento-value" name="departamento-value">
                                <input type="hidden" id="departamento-id-hidden" name="departamento-id-hidden">
                            </div>
                        </div>
                        



                        <div class="form-group">
                            <label for="plant">Ubicaci√≥n</label>
                            <div class="autocomplete-container">
                                <input type="text" id="plant" name="plant" required 
                                       placeholder="Escriba para buscar..." 
                                       class="autocomplete-input"
                                       autocomplete="off">
                                <div id="plant-suggestions" class="autocomplete-suggestions"></div>
                                <input type="hidden" id="plant-value" name="plant-value">
                                <input type="hidden" id="plant-id-hidden" name="plant-id-hidden">
                            </div>
                        </div>

                       
                        <div class="form-group">
                            <label for="applicant">Responsable del trabajo</label>
                            <input type="text" id="applicant" name="applicant" required class="compact" readonly>
                        </div>

                        <div class="form-group">
                                <label for="work-description">Descripci√≥n del trabajo</label>
                                <textarea id="work-description" name="work-description" rows="2" required></textarea>
                        </div>

                        
                       <div class="form-grid" id="permiso-np-grid1">
                            <div class="form-group">
                                <label for="maintenance-type">Tipo de mantenimiento</label>
                                <select id="maintenance-type" name="maintenance-type" required>
                                    <option value="" disabled selected>Seleccione un tipo</option>
                                    <option value="PREDICTIVO">PREDICTIVO</option>
                                    <option value="PREVENTIVO">PREVENTIVO</option>
                                    <option value="CORRECTIVO">CORRECTIVO</option>
                                    <option value="APOYO">APOYO</option>
                                    <option value="OTRO">OTRO</option>
                                </select>
                            </div>

                          
                        </div>
                        

                          <div class="form-group" id="other-maintenance-container" >
                                <label for="other-maintenance">Otro (especifique)</label>
                                <input type="text" id="other-maintenance" name="other-maintenance" class="compact">
                            </div>


                        <div class="form-group">
                            <label for="work-order">N√∫mero de O.T. </label>
                            <input type="text" id="work-order" name="work-order"  class="compact">
                        </div>

                         <div class="form-group">
                            <label for="contract-number">N√∫mero de contrato <span style="font-weight:normal;color:#888;">(solo si lo tienen)</span></label>
                            <input type="text" id="contract-number" name="contract-number" class="compact" placeholder="Ingrese el n√∫mero de contrato si aplica">
                        </div>
                        
                      </div>





                           

                       
                        <div class="form-grid" id="permiso-np-grid2">
                            <div class="form-group">
                                <label>¬øTiene que intervenir un equipo?</label>
                                <div class="radio-group" id="equipment-toggle">
                                    <label class="radio-option">
                                        <input type="radio" name="has-equipment" value="si" checked>
                                        <span class="radio-custom"></span>
                                        S√≠
                                    </label>
                                    <label class="radio-option">
                                        <input type="radio" name="has-equipment" value="no">
                                        <span class="radio-custom"></span>
                                        No
                                    </label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="tag">TAG</label>
                                <div style="position: relative;">
                                    <input type="text" id="tag" name="tag" class="compact">
                                    <div id="tag-suggestions" class="autocomplete-suggestions"></div>
                                </div>
                            </div>
                          
                            <div class="form-group">
                                <label for="equipment">Equipo a Intervenir</label>
                                <input type="text" id="equipment" name="equipment" required class="compact">
                            </div>

                        </div>

                        <!-- Bot√≥n de navegaci√≥n alineado a la derecha -->
                        <div style="display: flex; justify-content: flex-end; padding-top: 0.1rem;">
                            <button type="button" id="seccion1" class="btn primary next-step" data-next="2">
                                Siguiente <i class="ri-arrow-right-line"></i>
                            </button>
                        </div>



                    
                       
                       
                    
                    </div>
               <!-- Fin Secci√≥n 1: Encabezado -->
            </section>

            


                

                 
                <!-- Secci√≥n 2 : Permiso de trabajo -->
                <section class="form-section" data-section="2" id="permiso-np-section">
                    <div class="form-container" id="permiso-np-container">
                        <!-- ===== INICIO: CONSTRUCTOR DE FORMATO CON DRAG & DROP ===== -->
                        <!-- Agregado: Constructor de formato din√°mico para agregar formularios adicionales -->
                         
                        <div class="container" id="formato-constructor-container">
                            <!-- PANEL DE FORMULARIOS DISPONIBLES -->
                            <!-- Esta secci√≥n contiene los formularios que se pueden arrastrar -->
                            <div class="forms-panel" id="forms-panel">
                                <h3>Permisos Disponibles</h3>
                                
                                <!-- Cada item es draggable (arrastrable) y contiene el nombre del formulario -->
                                <div class="form-item" draggable="true" data-name="Permiso Altura">
                                    <i class="ri-arrow-up-line"></i> Permiso Altura
                                </div>
                                <div class="form-item" draggable="true" data-name="Permiso Espacio confinado">
                                    <i class="ri-door-lock-box-line"></i> Permiso Espacio confinado
                                </div>
                                <!--<div class="form-item" draggable="true" data-name="Permiso Agua a Alta Presi√≥n">
                                    <i class="ri-drop-line"></i> Permiso Agua a Alta Presi√≥n
                                </div>
                                <div class="form-item" draggable="true" data-name="Permiso Primera Apertura">
                                    <i class="ri-key-2-line"></i> Permiso Primera Apertura
                                </div>
                                <div class="form-item" draggable="true" data-name="Permiso Izaje con Gr√∫a">
                                    <i class="ri-attachment-2"></i> Permiso Izaje con Gr√∫a
                                </div>
                                <div class="form-item" draggable="true" data-name="Permiso El√©ctrico">
                                    <i class="ri-flashlight-line"></i> Permiso El√©ctrico
                                </div>-->
                                <div class="form-item" draggable="true" data-name="Permiso Fuego">
                                    <i class="ri-fire-fill"></i> Permiso Fuego
                                </div>
                                <div class="form-item" draggable="true" data-name="Permiso apertura">
                                    <i class="ri-lock-unlock-line"></i> Permiso Apertura
                                </div>
                                <div class="form-item" draggable="true" data-name="Permiso No Peligroso">
                                    <i class="ri-lock-unlock-line"></i> Permiso No Peligroso
                                </div>
                                  
                            </div>

                            <!-- √ÅREA DE DROP (ZONA DE DESTINO) -->
                            <!-- Aqu√≠ se soltar√°n los formularios arrastrados -->
                            <div class="main-format" id="main-format">
                                
                                <h4>Arrastra aqu√≠ los formularios requeridos</h4>
                                
                                <!-- Zona donde se sueltan los formularios -->
                                <div class="drop-zone" id="dropZone">
                                    <div class="drop-zone-placeholder">
                                        <i class="ri-drag-drop-line"></i>
                                        <p>Arrastra formularios desde el panel izquierdo</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- ===== FIN: CONSTRUCTOR DE FORMATO CON DRAG & DROP ===== -->

                        <!-- ===== TEMPLATES DE FORMULARIOS (OCULTOS) ===== -->
                        <!-- Estos templates contienen los formularios pre-creados que se clonar√°n al arrastrar -->
                        <div id="form-templates" style="display: none;">
                            
                            <!-- TEMPLATE: Permiso Altura -->
                            <template id="template-permiso-altura">
                                <div class="added-form" data-form-type="altura">
                                    <div class="added-form-header">
                                        <h4><i class="ri-arrow-up-line"></i> Permiso Altura</h4>
                                        <button type="button" class="remove-btn" title="Eliminar formulario">
                                            <i class="ri-close-line"></i> Eliminar
                                        </button>
                                    </div>

                                    <!-- En esta seccion se agrega el permiso en altura -->
                                    <div class="main-container">
    
                                        <div>
                                            <div class="section-header">Equipo de Protecci√≥n Personal</div>
                                            
                                            <div class="footer-row">
                                                <div class="footer-label">Arn√©s de cuerpo completo</div>
                                                <div class="footer-value-fixed">SI</div>
                                            </div>

                                            <div class="footer-row">
                                                <div class="footer-label">L√≠nea de vida retr√°ctil (1.8 metros a 5.5. metros de altura o cerca de espacio abiertos sin protecci√≥n lateral o perimetral)</div>
                                               <div class="input-cell-blue-short" style="width: 70px; flex-shrink: 0;">
                                                    <select class="select-yellow" id="linea_vida" style="text-align: center; width: 100%;">
                                                        <option value="SI">SI</option>
                                                        <option value="NO">NO</option>
                                                    </select>
                                                </div>
                                            </div>

                                            <div class="footer-row">
                                                <div class="footer-label">L√≠nea de restricci√≥n (limitar la distancia de desplazamiento hacia un borde)</div>
                                                <div class="footer-value-fixed">SI</div>
                                            </div>

                                            <div class="footer-row">
                                                <div class="footer-label">L√≠nea de vida con amortiguador (alturas mayores a 5.5. metros)</div>
                                                 <div class="input-cell-blue-short" style="width: 70px; flex-shrink: 0;">
                                                    <select class="select-yellow" id="linea_vida_amortiguador" style="text-align: center; width: 100%;">
                                                        <option value="SI">SI</option>
                                                        <option value="NO">NO</option>
                                                    </select>
                                                </div>
                                            </div>

                                            <div class="section-header">Factores Ambientales</div>

                                            <div class="footer-row">
                                                <div class="footer-label">Presencia Lluvia</div>
                                                <div class="input-cell-blue-short" style="width: 70px; flex-shrink: 0;">
                                                    <select class="select-yellow" id="presencia_lluvia" style="text-align: center; width: 100%;">
                                                        <option value="SI">SI</option>
                                                        <option value="NO">NO</option>
                                                    </select>
                                                </div>
                                            </div>

                                            <div class="footer-row">
                                                <div class="footer-label">Velocidad del viento en el sitio de trabajo menor a 30 km/hr (8.3 m/seg)</div>
                                                  <div class="input-cell-blue-short" style="width: 70px; flex-shrink: 0;">
                                                    <select class="select-yellow" id="velocidad_viento" style="text-align: center; width: 100%;">
                                                        <option value="SI">SI</option>
                                                        <option value="NO">NO</option>
                                                    </select>
                                                </div>
                                            </div>

                                            <div class="footer-row">
                                                <div class="footer-label">Presencia de gases t√≥xicos</div>
                                                <div class="footer-value-fixed">No</div>
                                            </div>
                                        </div>

                                        <div>
                                            <div class="section-header">Equipo de Protecci√≥n contra ca√≠das</div>
                                            
                                            <div class="footer-row">
                                                <div class="footer-label">Puntos de anclaje (tuber√≠as de di√°metro mayor a 8‚Äù y trabes, vigas u estructura mayor de 4‚Äù)</div>
                                                    <div class="input-cell-blue-short" style="width: 70px; flex-shrink: 0;">
                                                        <select class="select-yellow" id="puntos_anclaje" style="text-align: center; width: 100%;">
                                                            <option value="SI">SI</option>
                                                            <option value="NO">NO</option>
                                                            <option value="N/A">N/A</option>
                                                        </select>
                                                    </div>
                                            </div>
                                            
                                            <div class="footer-row">
                                                <div class="footer-label">L√≠nea de vida de acero de 3/8"</div>
                                                <div class="input-cell-blue-short" style="width: 70px; flex-shrink: 0;">
                                                    <select class="select-yellow" id="linea_vida_acero" style="text-align: center; width: 100%;">
                                                        <option value="SI">SI</option>
                                                        <option value="NO">NO</option>
                                                        <option value="N/A">N/A</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        <div>
                                            <div class="section-header">Control de Riesgos</div>
                                            
                                            <div class="footer-row">
                                                <div class="footer-label">¬øSe requiere andamio?</div>
                                                <div class="input-cell-blue-short" style="width: 70px; flex-shrink: 0;">
                                                    <select class="select-yellow" id="requiere_andamio" onchange="toggleAndamioEscalera(this)" style="text-align: center; width: 100%;">
                                                        <option value="SI">SI</option>
                                                        <option value="NO">NO</option>
                                                    </select>
                                                </div>
                                            </div>
                                            
                                            <div class="footer-row">
                                                <div class="footer-label">Andamio liberado (personal certificado y autorizado)</div>
                                               <div class="footer-value-fixed"><span id="andamio_liberado">SI</span></div>
                                            </div>

                                            <div class="footer-row">
                                                <div class="footer-label">Andamio ‚Äúcandadeado‚Äù cuando sea igual o mayor a 4 metros de altura</div>
                                                <div class="footer-value-fixed"><span id="andamio_candado">SI</span></div>
                                            </div>
                                        
                                            <div class="footer-row">
                                                <div class="footer-label">Escaleras tipo I Clase A diel√©ctrica</div>
                                                <div class="footer-value-fixed"><span id="escalera_dielectrica">N/A</span></div>
                                            </div>
                                            <div class="footer-row">
                                                <div class="footer-label">La escalera cumple la relaci√≥n 4:1</div>
                                                <div class="footer-value-fixed"><span id="escalera_relacion">N/A</span></div>
                                            </div>
                                            <div class="footer-row">
                                                <div class="footer-label">Escalera asegurada en la parte alta y baja</div>
                                                <div class="footer-value-fixed"><span id="escalera_asegurada">N/A</span></div>
                                            </div>
                                        
                                        
                                            <div class="footer-area">
                                         
                                        </div>
                                        
                                       

                                         <div style="display:none;">
                                                          <span id="tipo_permiso_altura">confinado</span>
                                                          <span id="columna_altura_valor">SI</span>
                                                      
                                          </div>


                                        </div>

                                        
                                    </div>

                                </div>
                            </template>



                            <!-- TEMPLATE: Permiso Espacio Confinado -->
                            <template id="template-permiso-espacio-confinado">
                                <div class="added-form" data-form-type="confinado">
                                    <div class="added-form-header">
                                        <h4><i class="ri-door-lock-box-line"></i> Permiso Espacio Confinado</h4>
                                        <button type="button" class="remove-btn" title="Eliminar formulario">
                                            <i class="ri-close-line"></i> Eliminar
                                        </button>
                                    </div>

                                    <div class="main-container">
    
                                        <div>
                                            <div class="section-header">Control de Energ√≠as:</div>
                                            
                                            <div class="footer-row">
                                                <div class="footer-label">Equipo aislado, desenergizado y bloqueado (LOTO)</div>
                                                <div class="footer-value-fixed">SI</div>
                                            </div>
                                            
                                            <div class="footer-row">
                                                <div class="footer-label">Equipo venteado</div>
                                                <div class="footer-value-fixed">SI</div>
                                            </div>
                                            
                                            <div class="footer-row">
                                                <div class="footer-label">Equipo drenado</div>
                                                <div class="footer-value-fixed">SI</div>
                                            </div>
                                            
                                            <div class="footer-row">
                                                <div class="footer-label">Inertizado</div>
                                                <div class="footer-value-fixed">SI</div>
                                            </div>

                                            <div class="section-header">Equipos y herramientas:</div>
                                            
                                            <div class="footer-row">
                                                <div class="footer-label">Iluminaci√≥n a prueba de explosi√≥n</div>
                                                <div class="footer-value-fixed">SI</div>
                                            </div>
                                            
                                            <div class="footer-row">
                                                <div class="footer-label">Equipos / herramientas el√©ctricos y manuales a prueba de explosi√≥n</div>
                                                <div class="footer-value-fixed">SI</div>
                                            </div>
                                            
                                            <div class="footer-row">
                                                <div class="footer-label">Extensiones el√©ctricas con Interruptor de Circuito por Falla a Tierra </div>
                                                <div class="footer-value-fixed">SI</div>
                                            </div>
                                            
                                            <div class="footer-row">
                                                <div class="footer-label">Extractor de aire en entrada hombre</div>
                                                <div class="footer-value-fixed">SI</div>
                                            </div>
                                            
                                            <div class="footer-row">
                                                <div class="footer-label">Ventilaci√≥n artificial</div>
                                                <div class="input-cell-yellow">
                                                    <select class="select-yellow" id="ventilacion_artificial">
                                                        <option value="SI">SI</option>
                                                        <option value="NO">NO</option>
                                                        <option value="N/A">N/A</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        <div>
                                            <div class="section-header">Monitoreo de Atmosferas:</div>
                                            
                                            <div class="footer-row">
                                                <div class="footer-label">Temperatura</div>
                                                <div class="input-cell-blue">
                                                    <input type="text" class="editable-blue" required id="temp" maxlength="30">
                                                </div>
                                            </div>
                                            
                                            <div class="footer-row">
                                                <div class="footer-label">Nombre del Guardavida</div>
                                                <div class="input-cell-blue">
                                                    <input type="text" class="editable-blue" required id="guardavida" maxlength="149">
                                                </div>
                                            </div>
                                            
                                            <div class="footer-row">
                                                <div class="footer-label">Nombre del guardavida suplente</div>
                                                <div class="input-cell-blue">
                                                    <input type="text" class="editable-blue" required id="suplente" maxlength="149">
                                                </div>
                                            </div>
                                            
                                            <div class="footer-row">
                                                <div class="footer-label">Realizar monitoreo inicial de O2 (19.5%-23.5%), CO (0ppm),LEL (0%), NH3 (0 ppm)</div>
                                                <div class="footer-value-fixed">SI</div>
                                            </div>
                                            
                                            <div class="footer-row">
                                                <div class="footer-label">Realizar monitoreo cada 30 minutos</div>
                                                <div class="footer-value-fixed">SI</div>
                                            </div>
                                            
                                            <div class="footer-row">
                                                <div class="footer-label">Detector de gas calibrado</div>
                                                <div class="footer-value-fixed">SI</div>
                                            </div>
                                            
                                            <div class="footer-row">
                                                <div class="footer-label">Tiempo de permanencia</div>
                                                <div class="input-cell-blue" style="width: 100px; min-width: unset;">
                                                    <input type="text" id ="permanencia" class="editable-blue" required style="text-align: center; width: 100%;" maxlength="49">
                                                </div>
                                            </div>
                                            
                                            <div class="footer-row">
                                                <div class="footer-label">Tiempo de descanso</div>
                                                <div class="input-cell-blue" style="width: 100px; min-width: unset;">
                                                    <input type="text" class="editable-blue" required id="descanso" style="text-align: center; width: 100%;" maxlength="49">
                                                </div>
                                            </div>
                                        </div>

                                        <div>
                                            <div class="section-header">Equipo de rescate:</div>
                                            
                                            <div class="footer-row">
                                                <div class="footer-label">Plan de rescate autorizado por SISMA</div>
                                                <div class="footer-value-fixed">SI</div>
                                            </div>
                                            
                                            <div class="footer-row">
                                                <div class="footer-label">Arn√©s tipo paraca√≠das y/o rescate</div>
                                                <div class="footer-value-fixed">SI</div>
                                            </div>
                                            
                                            <div class="footer-row">
                                                <div class="footer-label">Chequeo m√©dico previo al ingreso</div>
                                                <div class="footer-value-fixed">SI</div>
                                            </div>
                                            
                                            <div class="footer-row">
                                                <div class="footer-label">Equipo de rescate disponible acorde al plan de rescate</div>
                                                <div class="footer-value-fixed">SI</div>
                                            </div>
                                            
                                            <div class="footer-row">
                                                <div class="footer-label">Nombre del rescatista</div>
                                                <div class="input-cell-blue">
                                                    <input type="text" class="editable-blue" required id="rescatista" maxlength="149">
                                                </div>
                                            </div>
                                            
                                            <div class="footer-row">
                                                <div class="footer-label">Full face con l√≠nea de aire tipo D</div>
                                                <div class="footer-value-fixed">SI</div>
                                            </div>

                                            <div class="footer-area">
                                                  
                                               
                                            </div>
                                        </div>



                                                      <div style="display:none;">
                                                          <span id="tipo_permiso_confinado">confinado</span>
                                                          <span id="columna_confinado_valor">SI</span>
                                                      </div>

                                    </div>

                                </div>
                            </template>



                            

                             
                             <!-- TEMPLATE: Permiso Fuego -->
                            <template id="template-permiso-fuego">
                                  <div class="added-form" data-form-type="permiso-fuego">
                                    <div class="added-form-header">
                                        <h4><i class="ri-fire-fill"></i> Permiso Fuego</h4>
                                        <button type="button" class="remove-btn" title="Eliminar formulario">
                                            <i class="ri-close-line"></i> Eliminar
                                        </button>
                                    </div>
                                    
                                    <div class="main-container">
                                        <div class="col-left">
                                            <table>
                                                <thead>
                                                    <tr><th colspan="2" class="header-orange">Control de riesgos:</th></tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td class="label-orange">Retiro de material combustible y/o inflamable m√°s all√° de 11 metros</td>
                                                        <td class="value-fixed-orange">SI</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="label-orange">Sistemas de ventilaci√≥n y extracci√≥n apagados</td>
                                                        <td class="value-fixed-orange">SI</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="label-orange">V√°lvulas del sistema de supresi√≥n, aspersi√≥n abiertas</td>
                                                        <td class="value-fixed-orange">SI</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="label-orange">Uso de lonas ignifugas certificadas</td>
                                                        <td class="value-fixed-orange">SI</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="label-orange">Cubrir el material combustible / inflamable con lonas ignifugas certificadas cuando no sea posible retirarlo</td>
                                                        <td class="value-fixed-orange">SI</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="label-orange">Cubrir drenajes, espacios abiertos con lonas ignifugas u otro material no combustible cuando aplique</td>
                                                        <td class="value-fixed-orange">SI</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="label-orange">Manguera contraincendios presionada y lista para usarse</td>
                                                        <td class="value-fixed-orange">SI</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="label-orange">Se requiere m√°s de un vig√≠a de fuego</td>
                                                        <td class="input-cell-blue" style="padding: 0 !important;">
                                                            <select class="select-yellow" onchange="toggleVigiasAdicionales(this)" style="width: 100%; text-align: center;" id="vigia_fuego">
                                                                <option value="NO" selected>NO</option>
                                                                <option value="SI">SI</option>
                                                            </select>
                                                        </td>
                                                    </tr>
                                                    
                                                    
                                                </tbody>
                                            </table>

                                            <div id="rowVigiasAdicionales" class="footer-row" style="display: none; margin-top: 10px;">
                                                <div class="footer-label">Nombre del (os) vig√≠a (as) adicional (es)</div>
                                                <div class="input-cell-blue" style="flex: 1; border-radius: 4px;">
                                                    <input type="text" id="nombresVigiasAdicionales" class="editable-blue text-left" placeholder="Escriba nombres..." disabled style="border-radius: 4px;" maxlength="150">
                                                </div>
                                            </div>
                                        </div>


                                        <div class="col-mid">
                                            <table>
                                                <thead>
                                                    <tr><th colspan="2" class="header-orange">Equipo de Respuesta a Emergencias:</th></tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td class="label-orange">Extintor PQS 9 kg en sitio a no m√°s de 7 metros de la actividad</td>
                                                        <td class="value-fixed-orange">SI</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="label-orange">Bombas contraincendios operando</td>
                                                        <td class="value-fixed-orange">SI</td>
                                                    </tr>
                                                </tbody>
                                            </table>

                                            <table>
                                                <thead>
                                                    <tr><th colspan="2" class="header-orange">Equipo Protecci√≥n Personal Especifico:</th></tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td class="label-orange">Careta de soldador o careta facial</td>
                                                        <td class="value-fixed-orange">SI</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="label-orange">Lentes o goggles</td>
                                                        <td class="value-fixed-orange">SI</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="label-orange">Guantes, peto, mangas, guantes largos y polainas de carnaza</td>
                                                        <td class="value-fixed-orange">SI</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="label-orange">Capucha de algod√≥n (Monja)</td>
                                                        <td class="value-fixed-orange">SI</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="label-orange">Respirador para humos de soldadura</td>
                                                        <td class="value-fixed-orange">SI</td>
                                                    </tr>
                                                </tbody>
                                            </table>

                                            <div class="footer-row" style="margin-top: 10px;">
                                                <div class="footer-label">Otro</div>
                                                <div class="input-cell-blue" style="flex: 1; border-radius: 4px;">
                                                    <input type="text" id="eppOtro1" class="editable-blue text-left" value="N/A" style="border-radius: 4px;">
                                                </div>
                                            </div>

                                            <div class="footer-row" style="margin-top: 10px;">
                                                <div class="footer-label">Otro</div>
                                                <div class="input-cell-blue" style="flex: 1; border-radius: 4px;">
                                                    <input type="text" id="eppOtro2" class="editable-blue text-left" value="N/A" style="border-radius: 4px;">
                                                </div>
                                            </div>
                                        </div>


                                        <div class="col-right">
                                            <table>
                                                <thead>
                                                    <tr><th colspan="2" class="header-orange">Monitoreo de atmosfera</th></tr>
                                                </thead>

                                            </table>
                                            
                                            <div class="footer-row" style="margin-top: 10px;">
                                                <div class="footer-label">Temperatura</div>
                                                <div class="input-cell-blue" style="flex: 1; border-radius: 4px;">
                                                    <input type="text" id="temperatura_fuego" class="editable-blue" style="border-radius: 4px;" required maxlength="50">
                                                </div>
                                            </div>

                                            <div class="footer-row" style="margin-top: 10px;">
                                                <div class="footer-label">Nombre del Vig√≠a de fuego</div>
                                                <div class="input-cell-blue" style="flex: 1; border-radius: 4px;">
                                                    <input type="text" id="nombreVigiafuego" class="editable-blue text-left" required style="border-radius: 4px;" maxlength="149">
                                                </div>
                                            </div>

                                            <div class="footer-row" style="margin-top: 10px;">
                                                <div class="footer-label">Nombre del Vig√≠a de fuego suplente</div>
                                                <div class="input-cell-blue" style="flex: 1; border-radius: 4px;">
                                                    <input type="text" id="nombreSuplentefuego" class="editable-blue text-left" required style="border-radius: 4px;" maxlength="149">
                                                </div>
                                            </div>
                                            <table>
                                                <thead>
                                                   
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td class="label-orange">Realizar monitoreo inicial de O2 (19.5%-23.5%), CO (0ppm), LEL (0%), NH3 (0 ppm)</td>
                                                        <td class="value-fixed-orange">SI</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="label-orange">Realizar monitoreo cada 30 minutos.</td>
                                                        <td class="value-fixed-orange">SI</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="label-orange">Detector de gas calibrado</td>
                                                        <td class="value-fixed-orange">SI</td>
                                                    </tr>
                                                </tbody>
                                            </table>

                                     

                                            <div class="footer-area">
                                               
                                              
                                            </div>

                                    
                                     </div>

                                     
                                  
                                        
                                         <div style="display:none;">
                                                          <span id="tipo_permiso_fuego">confinado</span>
                                                          <span id="columna_fuego_valor">SI</span>
                                                      
                                          </div>


                                </div>
                            </template>

                            

                            <template id="template-permiso-apertura">
                                  <div class="added-form" data-form-type="permiso-apertura">
                                    <div class="added-form-header">
                                        <h4><i class="ri-lock-unlock-line"></i> Permiso Apertura</h4>
                                        <button type="button" class="remove-btn" title="Eliminar formulario">
                                            <i class="ri-close-line"></i> Eliminar
                                        </button>
                                    </div>

                                    <div class="main-container">  
                                        <div class="col-left">
                                            <div class="section-header">Control de Energ√≠as:</div>
                                            <table>
                                                <tr><td class="label-orange">Equipo aislado, desenergizado y bloqueado (LOTO, Entradas y Salidas)</td><td class="value-orange">SI</td></tr>
                                                <tr><td class="label-orange">Equipo venteado</td><td class="value-orange">SI</td></tr>
                                                <tr><td class="label-orange">Equipo drenado</td><td class="value-orange">SI</td></tr>
                                                <tr><td class="label-orange">Equipo Inertizado</td><td class="value-orange">SI</td></tr>
                                                
                                                <tr>
                                                    <td class="label-orange">Suspender trabajos adyacentes</td>
                                                     <td class="input-cell-blue" style="width: 70px; flex-shrink: 0;">
                                                        <select class="select-yellow" id="suspender_trabajos" style="text-align: center; width: 100%;">
                                                            <option value="SI">SI</option>
                                                            <option value="NO">NO</option>
                                                            <option value="N/A">N/A</option>
                                                        </select>
                                                    </td>
                                                </tr>
                                                
                                                <tr>
                                                    <td class="label-orange">Realizar monitoreo de gases de O2 (19.5%-23.5%), CO (0ppm), LEL (0%), NH3 (0 ppm)</td>
                                                     <td class="input-cell-blue" style="width: 70px; flex-shrink: 0;">
                                                        <select class="select-yellow" id="monitoreo_gases" style="text-align: center; width: 100%;">
                                                            <option value="SI">SI</option>
                                                            <option value="NO">NO</option>
                                                            <option value="N/A">N/A</option>
                                                        </select>
                                                    </td>
                                                </tr>
                                                
                                                <tr><td class="label-orange">Eliminar sustancias entrampadas</td><td class="value-orange">SI</td></tr>
                                                <tr><td class="label-orange">Delimitar el √°rea</td><td class="value-orange">SI</td></tr>
                                                <tr><td class="label-orange">Conocer la sustancia que estuvo contenida</td><td class="value-orange">SI</td></tr>
                                            </table>
                                        </div>

                                        <div class="col-right">
                                            <div class="section-header">Equipo de Protecci√≥n Especial:</div>
                                            <table>
                                                <tr><td class="label-orange">Capucha, chamarra y pantal√≥n anti√°cido</td><td class="value-orange">SI</td></tr>
                                                <tr><td class="label-orange">Full face</td>
                                                 <td class="input-cell-blue" style="width: 70px; flex-shrink: 0;">
                                                        <select class="select-yellow" id="full-face_apertura" style="text-align: center; width: 100%;">
                                                            <option value="SI">SI</option>
                                                            <option value="NO">NO</option>   
                                                        </select>
                                                    </td>
                                                </tr>
                                                <tr><td class="label-orange">Botas y guantes de hule</td><td class="value-orange">SI</td></tr>
                                            </table>

                                            <div class="footer-area">
                                               
                                            </div>
                                        </div>

                                    </div>

                                   
                                
                                        <div style="display:none;">
                                                          <span id="tipo_permiso_apertura">confinado</span>
                                                          <span id="columna_apertura_valor">SI</span>
                                                      
                                          </div>




                                    </div>
                            </template>  





                            <template id="template-permiso-nopeligroso">

                            <div class="added-form" data-form-type="permiso-nopeligroso">
                                <div class="added-form-header">
                                    <h4><i class="ri-lock-unlock-line"></i> Permiso No peligroso</h4>
                                    <button type="button" class="remove-btn" title="Eliminar formulario">
                                        <i class="ri-close-line"></i> Eliminar
                                    </button>
                                </div>
                                <div class="main-container" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 24px;">
                                    <!-- Cabeceras -->
                                    <div class="section-header" style="grid-column: 1 / span 2; text-align: center;">Control de Riesgos:</div>
                                    <div class="section-header" style="grid-column: 3 / span 1; text-align: center;">Equipo de Protecci√≥n Especial:</div>
                                    <!-- Columnas -->
                                    <div style="grid-column: 1;">
                                        <div class="footer-row"><div class="footer-label">Tropiezos, resbalones, ca√≠das un mismo nivel</div><div class="footer-value-fixed">SI</div></div>
                                        <div class="footer-row"><div class="footer-label">Ca√≠da a cuerpo de agua</div><div class="input-cell-yellow"><select class="select-yellow" name="caida_agua" id="pno_cr_1"><option value="NO" selected>NO</option><option value="SI">SI</option></select></div></div>
                                        <div class="footer-row"><div class="footer-label">Atrapado en o entre</div><div class="footer-value-fixed">SI</div></div>
                                        <div class="footer-row"><div class="footer-label">Sobre esfuerzo, estiramiento</div><div class="input-cell-yellow"><select class="select-yellow" name="sobre_esfuerzo" id="pno_cr_2" ><option value="NO">NO</option><option value="SI">SI</option></select></div></div>
                                        <div class="footer-row"><div class="footer-label">Exposici√≥n a vibraciones</div><div class="input-cell-yellow"><select class= "select-yellow" name="vibraciones" id="pno_cr_3" ><option value="NO" selected>NO</option><option value="SI">SI</option></select></div></div>
                                            <div class="footer-row"><div class="footer-label">Exposici√≥n a ruidos</div><div class="input-cell-yellow"><select class="select-yellow" name="ruidos" id="pno_cr_4" ><option value="NO" selected>NO</option><option value="SI">SI</option></select></div></div>
                                            <div class="footer-row"><div class="footer-label">Exposici√≥n a polvos</div><div class="input-cell-yellow"><select class="select-yellow" name="polvos" id="pno_cr_5"><option value="NO" selected>NO</option><option value="SI">SI</option></select></div></div>
                                            <div class="footer-row"><div class="footer-label">Exposici√≥n a qu√≠micos</div><div class="input-cell-yellow"><select class="select-yellow" name="quimicos" id="pno_cr_6"><option value="NO" selected>NO</option><option value="SI">SI</option></select></div></div>
                                            <div class="footer-row"><div class="footer-label">Fauna nociva</div><div class="input-cell-yellow"><select class="select-yellow" name="fauna" id="pno_cr_7"><option value="NO" selected>NO</option><option value="SI">SI</option></select></div></div>
                                        <div class="footer-row"><div class="footer-label">Proyecci√≥n de part√≠culas</div><div class="input-cell-yellow"><select class="select-yellow" name="particulas" id="pno_cr_8" ><option value="NO" selected>NO</option><option value="SI">SI</option></select></div></div>
                                    </div>
                                    <div style="grid-column: 2;">
                                        <div class="footer-row"><div class="footer-label">Carga suspendida</div><div class="input-cell-yellow"><select class="select-yellow" name="carga_suspendida"  id="pno_cr_9"><option value="NO" selected>NO</option><option value="SI">SI</option></select></div></div>
                                            <div class="footer-row"><div class="footer-label">Operaci√≥n de maquinaria pesada</div><div class="input-cell-yellow"><select class="select-yellow" name="maquinaria" id="pno_cr_10"><option value="NO" selected>NO</option><option value="SI">SI</option></select></div></div>
                                            <div class="footer-row"><div class="footer-label">Izamiento de carga</div><div class="input-cell-yellow"><select class="select-yellow" name="izam_carga" id="pno_cr_11"><option value="NO" selected>NO</option><option value="SI">SI</option></select></div></div>
                                            <div class="footer-row"><div class="footer-label">Izamiento de personal</div><div class="input-cell-yellow"><select class="select-yellow" name="izam_personal" id="pno_cr_12"><option value="NO" selected>NO</option><option value="SI">SI</option></select></div></div>
                                        <div class="footer-row"><div class="footer-label">Excavaci√≥n con menos de 1.5 metros de profundidad</div><div class="input-cell-yellow"><select class="select-yellow" name="excavacion" id="pno_cr_13"><option value="NO" selected>NO</option><option value="SI">SI</option></select></div></div>
                                    </div>
                                    <div style="grid-column: 3;">
                                        <div class="footer-row"><div class="footer-label">Careta facial</div><div class="input-cell-yellow"><select class="select-yellow" name="careta" id="pno_epe_1"><option value="NO" selected>NO</option><option value="SI">SI</option></select></div></div>
                                      
                                            <div class="footer-row"><div class="footer-label">Peto, guantes, polainas, mangas de carnaza</div><div class="input-cell-yellow"><select class="select-yellow" name="carnaza" id="pno_epe_2"><option value="NO" selected>NO</option><option value="SI">SI</option></select></div></div>
                                       
                                            <div class="footer-row"><div class="footer-label">Mascarilla contra polvos</div><div class="input-cell-yellow"><select class="select-yellow" name="masc_polvo" id="pno_epe_3"><option value="NO" selected>NO</option><option value="SI">SI</option></select></div></div>
                                       
                                            <div class="footer-row"><div class="footer-label">Mascarilla contra gases</div><div class="input-cell-yellow"><select class="select-yellow" name="masc_gases" id="pno_epe_4"><option value="NO" selected>NO</option><option value="SI">SI</option></select></div></div>
                                       
                                            <div class="footer-row"><div class="footer-label">Viboreras</div><div class="input-cell-yellow"><select class="select-yellow" name="viboreras" id="pno_epe_5"><option value="NO" selected>NO</option><option value="SI">SI</option></select></div></div>
                                     
                                            <div class="footer-row"><div class="footer-label">Peto, guantes de hule</div><div class="input-cell-yellow"><select class="select-yellow" name="epp_hule" id="pno_epe_6"><option value="NO" selected>NO</option><option value="SI">SI</option></select></div></div>

                                            <div class="footer-row"><div class="footer-label">Rodilleras</div><div class="input-cell-yellow"><select class="select-yellow" name="rodilleras" id="pno_epe_7"><option value="NO" selected>NO</option><option value="SI">SI</option></select></div></div>
                                
                                            <div class="footer-row"><div class="footer-label">Otro</div><div class="input-cell-yellow"><select class="select-yellow" name="otro_1" id="pno_epe_8"><option value="NO" selected>NO</option><option value="SI">SI</option></select></div></div>

                                        <div class="footer-row"><div class="footer-label">Otro</div><div class="input-cell-yellow"><select class="select-yellow" name="otro_2" id="pno_epe_9"><option value="NO" selected>NO</option><option value="SI">SI</option></select></div></div>
                                    </div>
                                    
                                </div>
                                <div style="display:none;">
                                    <span id="tipo_permiso_nopeligroso">nopeligroso</span>
                                    <span id="columna_nopeligroso_valor">SI</span>
                                </div>
                            </div>
                            </template>

                        </div>
                        <!-- ===== FIN: TEMPLATES DE FORMULARIOS ===== -->

                        
                            


                    
                           <div class="form-actions" id="permiso-np-actions">
                            <button type="button" class="btn secondary prev-step" data-prev="1">
                                <i class="ri-arrow-left-line"></i> Anterior
                            </button>
                            <button type="button" class="btn primary next-step" data-next="3">
                                Siguiente <i class="ri-arrow-right-line"></i>
                            </button>
                           </div>
                        </div>
                    </section>

                     <!-- Secci√≥n 3: Participantes -->
                     <section class="form-section" data-section="3">
                <div class="form-container">
                    <div class="form-header">
                        <div class="form-icon" style="background: linear-gradient(135deg, #2196F3 0%, #0D47A1 100%);">
                            <i class="ri-team-line"></i>
                        </div>
                        <div>
                            <h2>Personal Participante</h2>
                            <p>Registre a todas las personas involucradas</p>
                        </div>
                    </div>

                    <div class="participants-table">
                        <div class="participants-header">
                            <div>No.</div>
                            <div>Nombre</div>
                            <div>No. Credencial</div>
                            <div>Cargo</div>
                            <div>Funci√≥n</div>
                            <div>Acciones</div>
                        </div>

                        <div class="participant-row" data-index="1">
                            <div class="participant-number">1</div>
                            <div class="participant-field">
                                <input type="text" name="participant-name-1" placeholder="Nombre participante" required>
                            </div>
                            <div class="participant-field">
                                <input type="text" name="participant-credential-1" placeholder="Numero de credencial"  required>
                            </div>
                            <div class="participant-field">
                                <input type="text" name="participant-position-1" placeholder="Cargo" required>
                            </div>
                            <div class="participant-field">
                                <select name="participant-role-1" required>
                                    <option value="">Seleccione...</option>
                                    <option value="PARTICIPA">Participa</option>
                                    <option value="REVISA">Revisa</option>
                                    <option value="ANALIZA">Analiza</option>
                                    <option value="AUTORIZA">Autoriza</option>
                                </select>
                            </div>
                            <div class="participant-actions">
                                <button type="button" class="action-btn remove-participant" title="Eliminar">
                                    <i class="ri-delete-bin-line"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <button type="button" class="btn secondary" id="add-participant">
                        <i class="ri-user-add-line"></i> A√±adir Participante
                    </button>
                    
                    <button type="button" class="btn secondary" id="add-mass-load">
                        <i class="ri-user-add-line"></i> A√±adir Carga masiva
                    </button>


                    <div class="form-section-title">
                        <i class="ri-shield-user-line"></i>
                        <h3>Equipo de Protecci√≥n Personal</h3>
                    </div>

                    <div class="form-group">
                        <div id="ppe-required" class="ppe-required-fixed" style="white-space: pre-line; border: 1px solid #ccc; border-radius: 4px; padding: 8px; background: #f8f8f8; color: #333; min-height: 80px;">
Casco de seguridad
Lentes de seguridad
Cangurera o bolsa larga con mascarilla para gases (NH3)
Calzado de seguridad
Ropa de algod√≥n.
Protecci√≥n respiratoria
Guantes
                        </div>
                    </div>

                    
                
                    <div class="form-actions">
                        <button type="button" class="btn secondary prev-step" data-prev="2">
                            <i class="ri-arrow-left-line"></i> Anterior
                        </button>
                        <button type="button" id="btn-save-participants" class="btn primary next-step" data-next="4">
                            Siguiente <i class="ri-arrow-right-line"></i>
                        </button>
                    </div>
                
            </section>

<!-- Secci√≥n 4: AST -->
            <section class="form-section" data-section="4">
                <div class="form-container">
                    <div class="form-header">
                        <div class="form-icon" style="background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);">
                            <i class="ri-alert-line"></i>
                        </div>
                        <div>
                            <h2>An√°lisis de Seguridad en el Trabajo (AST)</h2>
                            <p>Describa las actividades y riesgos asociados</p>
                        </div>
                    </div>

                    <div class="ast-activities extended">
                        <div class="ast-table-header">
                            <div>No.</div>
                            <div>Secuencia de la Actividad</div>
                            <div>Riesgos Potenciales</div>
                            <div>Acciones Preventivas</div>
                            <div>Acciones</div>
                        </div>
                    
                        <div class="ast-activity" data-index="1">
                            <div class="ast-activity-number">1</div>
                            <div class="ast-activity-field">
                                <textarea name="ast-activity-1" rows="2"></textarea>
                            </div>
                            <div class="ast-activity-field">
                                <textarea name="ast-hazards-1" rows="2" required placeholder="Riesgos Potenciales"></textarea>
                            </div>
                            <div class="ast-activity-field">
                                <textarea name="ast-preventions-1" rows="2" required placeholder="Acciones Preventivas"></textarea>
                            </div>
                            <div class="ast-activities-actions">
                                <button type="button" class="action-btn remove-participant" title="Eliminar">
                                    <i class="ri-delete-bin-line"></i>
                                </button>
                            </div>
                        </div>
                        
                    </div>
                    

                    <button type="button" class="btn secondary" id="add-activity">
                        <i class="ri-add-line"></i> A√±adir Actividad
                    </button>

                    <button type="button" class="btn secondary" id="add-mass-load-ast">
                        <i class="ri-file-excel-line"></i> A√±adir carga masiva
                    </button>
                        <!-- √Årea de firma digital visible autom√°ticamente -->
                        <div id="firma-area" style="margin: 32px 0;">
                            <h3 style="margin-bottom: 8px;">Firma del responsable</h3>
                            <canvas id="canvasFirma" width="400" height="200" style="border:1px solid #ccc; border-radius:8px; background:#fff; cursor:crosshair;"></canvas>
                            <input type="hidden" id="outputBase64Firma" />
                            <div class="controls" style="margin: 16px 0; display: flex; gap: 12px;">
                                <button class="btn-clear" id="limpiarFirma" type="button" style="background:#eee; color:#333; border:none; border-radius:4px; padding:6px 16px; cursor:pointer;">Limpiar √°rea</button>
                            </div>
                            <div style="margin-top:8px; color:#888; font-size:0.95em;">Utilice el √°rea para firmar antes de guardar el permiso.</div>
                        </div>



                       <div id="modalAgregarFirma" class="modal-confirmar" style="display:none;">
                                <div class="modal-confirmar-content" style="max-width: 500px;">
                                    <div class="container" style="padding: 0; background: none; box-shadow: none;">
                                        <h2 style="margin-top:0;">Favor de firmar</h2>
                                        <canvas id="canvas" width="400" height="200" style="border:1px solid #ccc; border-radius:8px; background:#fff; cursor:crosshair;"></canvas>
                                        <!-- Input oculto para la firma en base64 -->
                                        <input type="hidden" id="outputBase64" />
                                        <div class="controls" style="margin: 16px 0; display: flex; gap: 12px;">
                                            <button class="btn-clear" id="limpiar" type="button" style="background:#eee; color:#333; border:none; border-radius:4px; padding:6px 16px; cursor:pointer;">Limpiar √°rea</button>
                                            <button class="btn-save" id="guardar" type="button" style="background:#1976d2; color:#fff; border:none; border-radius:4px; padding:6px 16px; cursor:pointer;">Guardar y Continuar</button>
                                            <button id="btnAgregarFirmaCancelar" type="button" class="btn-cancel" style="margin-left:auto;">Cancelar</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button id="btnAgregarFirmaContinuar" type="button" style="display:none"></button>

                            


                    <div class="form-actions">
                        <button type="button" class="btn secondary prev-step" data-prev="3">
                            <i class="ri-arrow-left-line"></i> Anterior
                        </button>
                        <button type="submit" class="btn primary">
                            <i class="ri-save-line"></i> Guardar Permiso Completo
                        </button>
                    
                    </div>
                    
                </div>
            </section>



        </form>
    </main>
</div>

    <!-- Modal de confirmaci√≥n -->
    <div class="modal" id="confirmation-modal">
        <div class="modal-content">
            <div class="modal-icon success">
                <i class="ri-checkbox-circle-line"></i>
            </div>
            <h3>Permiso creado exitosamente</h3>
            <p>El permiso de trabajo con AST ha sido registrado en el sistema con el n√∫mero: <strong id="generated-permit">GSI-SI-FO-002-XXXX</strong></p>
            <div class="modal-actions">
                <button class="btn secondary" id="modal-close-btn">Cerrar</button>
                
            </div>
        </div>
    </div>

    <!-- Modal de carga masiva Excel  Participantes-->
    <div class="modal" id="mass-load-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìÇ Importar Participantes desde Excel</h3>
                <span class="close-modal" id="close-mass-modal">&times;</span>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 15px;">Sube un archivo Excel con las siguientes columnas: <strong>Nombre, Credencial, Cargo</strong></p>
                <input type="file" id="excelInput" accept=".xlsx,.xls" style="margin-bottom: 15px;">
                <div id="preview-tabla"></div>
            </div>
            <div class="modal-footer">
                <button class="btn secondary" id="cancel-mass-load">Cancelar</button>
                <button class="btn primary" id="confirm-mass-load" disabled>Importar Participantes</button>
            </div>
        </div>
    </div>



    <div id="loader-ubicacion" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:9999;align-items:center;justify-content:center;background:rgba(255,255,255,0.7)">
  <div style="font-size:2em;">Obteniendo ubicaci√≥n...</div>
</div>


    <!-- Modal de carga masiva AST desde Excel -->
    <div class="modal" id="mass-load-modal-ast" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìä Importar Actividades AST desde Excel</h3>
                <span class="close-modal" id="close-mass-modal-ast">&times;</span>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 15px;">Sube un archivo Excel con las siguientes columnas: <strong>Secuencia-Actividad, Peligros-potenciales, Acciones-Preventivas</strong></p>
                <input type="file" id="excelInput-ast" accept=".xlsx,.xls" style="margin-bottom: 15px;">
                <div id="preview-tabla-ast"></div>
            </div>
            <div class="modal-footer">
                <button class="btn secondary" id="cancel-mass-load-ast">Cancelar</button>
                <button class="btn primary" id="confirm-mass-load-ast" disabled>Importar Actividades</button>
            </div>
        </div>
    </div>





                            <div id="modalAgregarFirma" class="modal-confirmar" style="display:none;">
                                <div class="modal-confirmar-content" style="max-width: 500px;">
                                    <div class="container" style="padding: 0; background: none; box-shadow: none;">
                                        <h2 style="margin-top:0;">Favor de firmar</h2>
                                        <canvas id="canvas" width="400" height="200" style="border:1px solid #ccc; border-radius:8px; background:#fff; cursor:crosshair;"></canvas>
                                        <!-- Input oculto para la firma en base64 -->
                                        <input type="hidden" id="outputBase64" />
                                        <div class="controls" style="margin: 16px 0; display: flex; gap: 12px;">
                                            <button class="btn-clear" id="limpiar" type="button" style="background:#eee; color:#333; border:none; border-radius:4px; padding:6px 16px; cursor:pointer;">Limpiar √°rea</button>
                                            <button class="btn-save" id="guardar" type="button" style="background:#1976d2; color:#fff; border:none; border-radius:4px; padding:6px 16px; cursor:pointer;">Guardar y Continuar</button>
                                            <button id="btnAgregarFirmaCancelar" type="button" class="btn-cancel" style="margin-left:auto;">Cancelar</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button id="btnAgregarFirmaContinuar" type="button" style="display:none"></button>

                        


                           






      <!-- Script de verificaci√≥n de autenticaci√≥n -->
    <script src="/JS/generales/auth-check.js"></script>
    <script>
      // Verificar autenticaci√≥n antes de cargar contenido
      (async function () {
        const usuario = await verificarRol(["usuario"]);
        if (!usuario) return; // auth-check.js ya redirigi√≥
        // El contenido se carga normalmente si est√° autenticado
      })();

            // Funci√≥n para alternar valores de andamio/escalera (footer-value-fixed)
            function toggleAndamioEscalera(selectElement) {
                const formContainer = selectElement.closest('.added-form');
                if (!formContainer) return;
                const requiereAndamio = selectElement.value;
                // Buscar los spans de escalera dentro del mismo formulario
                const escaleraDielectrica = formContainer.querySelector('#escalera_dielectrica');
                const escaleraRelacion = formContainer.querySelector('#escalera_relacion');
                const escaleraAsegurada = formContainer.querySelector('#escalera_asegurada');
                // Buscar los spans de andamio dentro del mismo formulario
                const andamioLiberado = formContainer.querySelector('#andamio_liberado');
                const andamioCandado = formContainer.querySelector('#andamio_candado');

                if (requiereAndamio === 'SI') {
                    if (escaleraDielectrica) escaleraDielectrica.textContent = 'N/A';
                    if (escaleraRelacion) escaleraRelacion.textContent = 'N/A';
                    if (escaleraAsegurada) escaleraAsegurada.textContent = 'N/A';
                    if (andamioLiberado) andamioLiberado.textContent = 'SI';
                    if (andamioCandado) andamioCandado.textContent = 'SI';
                } else {
                    if (escaleraDielectrica) escaleraDielectrica.textContent = 'SI';
                    if (escaleraRelacion) escaleraRelacion.textContent = 'SI';
                    if (escaleraAsegurada) escaleraAsegurada.textContent = 'SI';
                    if (andamioLiberado) andamioLiberado.textContent = 'NO';
                    if (andamioCandado) andamioCandado.textContent = 'NO';
                }
            }

      // Funci√≥n existente para vig√≠as adicionales (permiso fuego)
      function toggleVigiasAdicionales(selectElement) {
        const formContainer = selectElement.closest('.added-form');
        if (!formContainer) return;
        
        const rowVigiasAdicionales = formContainer.querySelector('#rowVigiasAdicionales');
        const inputVigiasAdicionales = formContainer.querySelector('#nombresVigiasAdicionales');
        
        if (selectElement.value === 'SI') {
          if (rowVigiasAdicionales) rowVigiasAdicionales.style.display = 'flex';
          if (inputVigiasAdicionales) inputVigiasAdicionales.disabled = false;
        } else {
          if (rowVigiasAdicionales) rowVigiasAdicionales.style.display = 'none';
          if (inputVigiasAdicionales) {
            inputVigiasAdicionales.disabled = true;
            inputVigiasAdicionales.value = '';
          }
        }
      }
    </script>
    <!-- SheetJS para leer archivos Excel -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <!--<script src="/Modules/Fomularios/PT1/PT1.js"></script> -->
    <script src="/Modules/Fomularios/Generales/email.js"></script>
    <script src="/Modules/Fomularios/Generales/seccion1.js"></script>
    <script src="/Modules/Fomularios/Generales/buscar_equipo_tag.js"></script>
    <script src="/Modules/Fomularios/PT1/seccion2.js"></script>
    <script src="/Modules/Fomularios/Generales/seccion3.js"></script> 
    <script src="/Modules/Fomularios/Generales/seccion4.js"></script>
    <script src="/Modules/Fomularios/Generales/navegacion.js"></script>
    <script src="/Modules/Fomularios/Generales/cargadedatos.js"></script> 
    <script src="/Modules/Fomularios/Generales/carga_masiva_ast.js"></script>
    <script src="/Modules/Fomularios/Generales/lienzos_firma_seccion4.js"></script>
    <script src="/Modules/Fomularios/Generales/obtenerUbicacionYIPseccion4.js"></script>






</body>
</html>